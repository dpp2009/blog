{"gid":"194","title":"\u6df1\u5165\u89e3\u6790php\u4e4bsphinx","date":"1393398635","content":"<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t&lt;?php&nbsp;<br \/>\n\/\/\u53c2\u6570\u7b5b\u9009\n<\/p>\n<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t\/\/\u7b5b\u9009cat_id=2<br \/>\n$cl-&gt;SetFilter(\"cat_id\",array(2));<br \/>\n\/\/\u4ec5\u5728id\u4e3a1\u30013\u30017\u7684\u5b50\u8bba\u575b\u4e2d\u641c\u7d22<br \/>\n$cl-&gt;SetFilter(\"forum_id\",array(1,3,7));<br \/>\n\/\/\u8303\u56f4\u7b5b\u9009<br \/>\n\/\/\u7b5b\u9009\u53d1\u5e03\u65f6\u95f4\u4e3a\u4eca\u5929,\u53c2\u6570\u4e3aint\u65f6\u95f4\u6233<br \/>\n$cl-&gt;SetFilterRange(\"starttime\",123,124);<br \/>\n\/\/\u7b5b\u9009\u4ef7\u683c<br \/>\n$cl-&gt;SetFilterRange(\"price\",10.0,99.9);<br \/>\n\/\/ \u5206\u7ec4<br \/>\n\/\/\u6309\u7167item_id\u5206\u7ec4\uff0c\u5e76\u4e14\u6309\u7167order desc\u6392\u5e8f<br \/>\n$cl-&gt;SetGroupBy(\"item_id\",SPH_GROUP_ATTR,\"order desc\");<br \/>\n\/\/\u6392\u5e8f\u6a21\u5f0f<br \/>\n\/\/\u6309\u7167price desc\u6392\u5e8f<br \/>\n$cl-&gt;SetSortMode(SPH_SORT_ATTR_DESC,\"price\");<br \/>\n\u6ce8\u610f\uff1a\u4f1a\u88abSetGroupBy\u4e2d\u7684\u6392\u5e8f\u8986\u76d6\n<\/p>\n<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t\/\/ \u5339\u914d\u67e5\u8be2\u8bcd\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a<br \/>\n$cl-&gt;SetMatchMode ( SPH_MATCH_ANY );<br \/>\nSPH_MATCH_ALL, \u5339\u914d\u6240\u6709\u67e5\u8be2\u8bcd(\u9ed8\u8ba4\u6a21\u5f0f);<br \/>\nSPH_MATCH_ANY, \u5339\u914d\u67e5\u8be2\u8bcd\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a;<br \/>\nSPH_MATCH_PHRASE, \u5c06\u6574\u4e2a\u67e5\u8be2\u770b\u4f5c\u4e00\u4e2a\u8bcd\u7ec4\uff0c\u8981\u6c42\u6309\u987a\u5e8f\u5b8c\u6574\u5339\u914d;<br \/>\nSPH_MATCH_BOOLEAN, \u5c06\u67e5\u8be2\u770b\u4f5c\u4e00\u4e2a\u5e03\u5c14\u8868\u8fbe\u5f0f (\u53c2\u89c1 \u7b2c 5.2 \u8282 \u201c\u5e03\u5c14\u67e5\u8be2\u8bed\u6cd5\u201d);<br \/>\nSPH_MATCH_EXTENDED, \u5c06\u67e5\u8be2\u770b\u4f5c\u4e00\u4e2aCoreSeek\/Sphinx\u5185\u90e8\u67e5\u8be2\u8bed\u8a00\u7684\u8868\u8fbe\u5f0f (\u53c2\u89c1 \u7b2c 5.3 \u8282 \u201c\u6269\u5c55\u67e5\u8be2\u8bed\u6cd5\u201d). \u4ece\u7248\u672cCoreseek 3\/Sphinx 0.9.9\u5f00\u59cb, \u8fd9\u4e2a\u9009\u9879\u88ab\u9009\u9879SPH_MATCH_EXTENDED2\u4ee3\u66ff\uff0c\u5b83\u63d0\u4f9b\u4e86\u66f4\u591a\u529f\u80fd\u548c\u66f4\u4f73\u7684\u6027\u80fd\u3002\u4fdd\u7559\u8fd9\u4e2a\u9009\u9879\u662f\u4e3a\u4e86\u4e0e\u9057\u7559\u7684\u65e7\u4ee3\u7801\u517c\u5bb9\u2014\u2014\u8fd9\u6837\u5373\u4f7f Sphinx\u53ca\u5176\u7ec4\u4ef6\u5305\u62ecAPI\u5347\u7ea7\u7684\u65f6\u5019\uff0c\u65e7\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fd8\u80fd\u591f\u7ee7\u7eed\u5de5\u4f5c\u3002<br \/>\nSPH_MATCH_EXTENDED2, \u4f7f\u7528\u7b2c\u4e8c\u7248\u7684\u201c\u6269\u5c55\u5339\u914d\u6a21\u5f0f\u201d\u5bf9\u67e5\u8be2\u8fdb\u884c\u5339\u914d.<br \/>\nSPH_MATCH_FULLSCAN, \u5f3a\u5236\u4f7f\u7528\u4e0b\u6587\u6240\u8ff0\u7684\u201c\u5b8c\u6574\u626b\u63cf\u201d\u6a21\u5f0f\u6765\u5bf9\u67e5\u8be2\u8fdb\u884c\u5339\u914d\u3002\u6ce8\u610f\uff0c\u5728\u6b64\u6a21\u5f0f\u4e0b\uff0c\u6240\u6709\u7684\u67e5\u8be2\u8bcd\u90fd\u88ab\u5ffd\u7565\uff0c\u5c3d\u7ba1\u8fc7\u6ee4\u5668\u3001\u8fc7\u6ee4\u5668\u8303\u56f4\u4ee5\u53ca\u5206\u7ec4\u4ecd\u7136\u8d77\u4f5c\u7528\uff0c\u4f46\u4efb\u4f55\u6587\u672c\u5339\u914d\u90fd\u4e0d\u4f1a\u53d1\u751f.\n<\/p>\n<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t\/\/\u4ece0\u5f00\u59cb\u67e5\u8be2\uff0c\u67e5\u8be230\u6761\uff0c\u8fd4\u56de\u7ed3\u679c\u6700\u591a\u4e3a1000<br \/>\n$cl-&gt;setLimits(0,30,1000);<br \/>\n\/\/ \u4ece\u540d\u79f0\u4e3aindex\u7684sphinx\u7d22\u5f15\u67e5\u8be2\u201c\u7535\u5f71\u7968\u201d<br \/>\n$cl-&gt;Query(\"\u7535\u5f71\u7968\",\"index\");<br \/>\n\/\/ \u4ece\u540d\u79f0\u4e3aindex\u7684sphinx\u7d22\u5f15\u67e5\u8be2\u201c\u7535\u5f71\u7968\u201d<br \/>\n$sp-&gt;SetGroupBy('item_id',SPH_GROUP_ATTR,'s_order desc');<br \/>\n$sp-&gt;SetFilter('city_id','1');<br \/>\n$sp-&gt;SetFilter('cat_id',array(1));<br \/>\n$sp-&gt;SetLimit(0,10,1000);<br \/>\n$sp-&gt;AddQuery('\u7535\u5f71\u7968','index');<br \/>\n$sp-&gt;ResetFilters();\/\/\u91cd\u7f6e\u7b5b\u9009\u6761\u4ef6<br \/>\n$sp-&gt;ResetGroupBy();\/\/\u91cd\u7f6e\u5206\u7ec4<br \/>\n$sp-&gt;SetGroupBy('item_id', SPH_GROUPBY_ATTR, 's_order desc');<br \/>\n$sp-&gt;setFilter('city_id', '2');<br \/>\n$sp-&gt;setFilter('cat_id', array(2));<br \/>\n$sp-&gt;setLimits(0, 20, 1000);<br \/>\n$sp-&gt;AddQuery('\u6e29\u6cc9', 'index');<br \/>\n$sp-&gt;ResetFilters();\/\/ \u91cd\u7f6e\u7b5b\u9009\u6761\u4ef6<br \/>\n$sp-&gt;ResetGroupBy();\/\/\u91cd\u7f6e\u5206\u7ec4<br \/>\n$results = $sp-&gt;RunQuries();<br \/>\n\u6279\u91cf\u67e5\u8be2\uff08\u6216\u591a\u67e5\u8be2\uff09\u4f7fsearchd\u80fd\u591f\u8fdb\u884c\u53ef\u80fd\u7684\u5185\u90e8\u4f18\u5316\uff0c\u5e76\u4e14\u65e0\u8bba\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u4f1a\u51cf\u5c11\u7f51\u7edc\u8fde\u63a5\u548c\u8fdb\u7a0b\u521b\u5efa\u65b9\u9762\u7684\u5f00\u9500\u3002\u76f8\u5bf9\u4e8e\u5355\u72ec\u7684\u67e5\u8be2\uff0c\u6279\u91cf\u67e5\u8be2\u4e0d\u4f1a\u5f15\u5165\u4efb\u4f55\u989d\u5916\u7684\u5f00\u9500\u3002\u56e0\u6b64\u5f53\u60a8\u7684Web\u9875\u8fd0\u884c\u51e0\u4e2a\u4e0d\u540c\u7684\u67e5\u8be2\u65f6\uff0c\u4e00\u5b9a\u8981\u8003\u8651\u4f7f\u7528\u6279\u91cf\u67e5\u8be2\u3002<br \/>\n\u4f8b\u5982\uff0c\u591a\u6b21\u8fd0\u884c\u540c\u4e00\u4e2a\u5168\u6587\u67e5\u8be2\uff0c\u4f46\u4f7f\u7528\u4e0d\u540c\u7684\u6392\u5e8f\u6216\u5206\u7ec4\u8bbe\u7f6e\uff0c\u8fd9\u4f1a\u4f7fsearchd\u4ec5\u8fd0\u884c\u4e00\u6b21\u5f00\u9500\u6602\u8d35\u7684\u5168\u6587\u68c0\u7d22\u548c\u76f8\u5173\u5ea6\u8ba1\u7b97\uff0c\u7136\u540e\u5728\u6b64\u57fa\u7840\u4e0a\u4ea7\u751f\u591a\u4e2a\u5206\u7ec4\u7ed3\u679c\u3002<br \/>\n\u6709\u65f6\u60a8\u4e0d\u4ec5\u9700\u8981\u7b80\u5355\u5730\u663e\u793a\u641c\u7d22\u7ed3\u679c\uff0c\u800c\u4e14\u8981\u663e\u793a\u4e00\u4e9b\u4e0e\u7c7b\u522b\u76f8\u5173\u7684\u8ba1\u6570\u4fe1\u606f\uff0c\u4f8b\u5982\u6309\u5236\u9020\u5546\u5206\u7ec4\u540e\u7684\u4ea7\u54c1\u6570\u76ee\uff0c\u6b64\u65f6\u6279\u91cf\u67e5\u8be2\u4f1a\u8282\u7ea6\u5927\u91cf\u7684\u5f00\u9500\u3002 \u82e5\u65e0\u6279\u91cf\u67e5\u8be2\uff0c\u60a8\u4f1a\u5fc5\u987b\u5c06\u8fd9\u4e9b\u672c\u8d28\u4e0a\u51e0\u4e4e\u76f8\u540c\u7684\u67e5\u8be2\u8fd0\u884c\u591a\u6b21\u5e76\u53d6\u56de\u76f8\u540c\u7684\u5339\u914d\u9879\uff0c\u6700\u540e\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u3002\u82e5\u4f7f\u7528\u6279\u91cf\u67e5\u8be2\uff0c\u60a8\u53ea\u987b\u5c06\u8fd9\u4e9b\u67e5\u8be2\u7b80\u5355\u5730\u7ec4\u6210\u4e00\u4e2a \u6279\u91cf\u67e5\u8be2\uff0cSphinx\u4f1a\u5728\u5185\u90e8\u4f18\u5316\u6389\u8fd9\u4e9b\u5197\u4f59\u7684\u5168\u6587\u641c\u7d22\u3002<br \/>\nAddQuery()\u5728\u5185\u90e8\u5b58\u50a8\u5168\u90e8\u5f53\u524d\u8bbe\u7f6e\u72b6\u6001\u4ee5\u53ca\u67e5\u8be2\uff0c\u60a8\u4e5f\u53ef\u5728\u540e\u7eed\u7684AddQuery()\u8c03\u7528\u4e2d\u6539\u53d8\u8bbe\u7f6e\u3002\u65e9\u5148\u52a0\u5165\u7684\u67e5\u8be2\u4e0d\u4f1a\u88ab\u5f71\u54cd\uff0c\u5b9e\u9645\u4e0a\u6ca1\u6709\u4efb\u4f55\u529e\u6cd5\u53ef\u4ee5\u6539\u53d8\u5b83\u4eec\u3002\n<\/p>\n<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t\u7528\u4e0a\u8ff0\u4ee3\u7801\uff0c\u7b2c\u4e00\u4e2a\u67e5\u8be2\u4f1a\u5728\u201cdocuments\u201d\u7d22\u5f15\u4e0a\u67e5\u8be2\u201chello world\u201d\u5e76\u5c06\u7ed3\u679c\u6309\u76f8\u5173\u5ea6\u6392\u5e8f\uff0c\u7b2c\u4e8c\u4e2a\u67e5\u8be2\u4f1a\u5728\u201cproducts\u201d\u7d22\u5f15\u4e0a\u67e5\u8be2\u201cipod\u201d\u5e76\u5c06\u7ed3\u679c\u6309\u4ef7\u683c\u6392\u5e8f\uff0c\u7b2c\u4e09\u4e2a\u67e5\u8be2\u5728\u201cbooks\u201d\u7d22\u5f15\u4e0a\u641c \u7d22\u201charry potter\u201d\uff0c\u7ed3\u679c\u4ecd\u6309\u4ef7\u683c\u6392\u5e8f\u3002\u6ce8\u610f\uff0c\u7b2c\u4e8c\u4e2aSetSortMode()\u8c03\u7528\u5e76\u4e0d\u4f1a\u5f71\u54cd\u7b2c\u4e00\u4e2a\u67e5\u8be2\uff08\u56e0\u4e3a\u5b83\u5df2\u7ecf\u88ab\u6dfb\u52a0\u4e86\uff09\uff0c\u4f46\u540e\u9762\u7684\u4e24\u4e2a\u67e5\u8be2\u90fd\u4f1a\u53d7\u5f71 \u54cd\u3002<br \/>\n\u6b64\u5916\uff0c\u5728AddQuery()\u4e4b\u524d\u8bbe\u7f6e\u7684\u4efb\u4f55\u8fc7\u6ee4\uff0c\u90fd\u4f1a\u88ab\u540e\u7eed\u67e5\u8be2\u7ee7\u7eed\u4f7f\u7528\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u4e2a\u67e5\u8be2\u524d\u4f7f\u7528SetFilter()\uff0c\u5219\u901a\u8fc7 AddQuery()\u6267\u884c\u7684\u7b2c\u4e8c\u4e2a\u67e5\u8be2\uff08\u4ee5\u53ca\u968f\u540e\u7684\u6279\u91cf\u67e5\u8be2\uff09\u90fd\u4f1a\u5e94\u7528\u540c\u6837\u7684\u8fc7\u6ee4\uff0c\u9664\u975e\u4f60\u5148\u8c03\u7528ResetFilters()\u6765\u6e05\u9664\u8fc7\u6ee4\u89c4\u5219\u3002\u540c\u65f6\uff0c\u4f60\u8fd8 \u53ef\u4ee5\u968f\u65f6\u52a0\u5165\u65b0\u7684\u8fc7\u6ee4\u89c4\u5219<br \/>\nAddQuery()\u5e76\u4e0d\u4fee\u6539\u5f53\u524d\u72b6\u6001\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5df2\u6709\u7684\u5168\u90e8\u6392\u5e8f\u3001\u8fc7\u6ee4\u548c\u5206\u7ec4\u8bbe\u7f6e\u90fd\u4e0d\u4f1a\u56e0\u8fd9\u4e2a\u8c03\u7528\u800c\u53d1\u751f\u6539\u53d8\uff0c\u56e0\u6b64\u540e\u7eed\u7684\u67e5\u8be2\u5f88\u5bb9\u6613\u5730\u590d\u7528\u73b0\u6709\u8bbe\u7f6e\u3002<br \/>\nAddQuery()\u8fd4\u56deRunQueries()\u7ed3\u679c\u8fd4\u56de\u7684\u6570\u7ec4\u4e2d\u7684\u4e00\u4e2a\u4e0b\u6807\u3002\u5b83\u662f\u4e00\u4e2a\u4ece0\u5f00\u59cb\u7684\u9012\u589e\u6574\u6570\uff0c\u5373\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528\u8fd4\u56de0\uff0c\u7b2c\u4e8c\u6b21\u8fd4\u56de1\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u8fd9\u4e2a\u65b9\u4fbf\u7684\u7279\u6027\u4f7f\u4f60\u5728\u9700\u8981\u8fd9\u4e9b\u4e0b\u6807\u7684\u65f6\u5019\u4e0d\u7528\u624b\u5de5\u8bb0\u5f55\u5b83\u4eec\u3002<br \/>\n?&gt;\n<\/p>","excerpt":"<p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t&lt;?php&nbsp;<br \/>\n\/\/\u53c2\u6570\u7b5b\u9009\n<\/p><p style=\"color:#111111;font-family:\u5b8b\u4f53, \u5fae\u8f6f\u96c5\u9ed1, Verdana, Helvetica;font-size:14px;background-color:#FFFFFF;\">\n\t\/\/\u7b5b\u9009cat_id=2<br \/>\n$cl-&gt;SetFilter(\"cat_id\",array(2));<br \/>\n\/\/\u4ec5\u5728id\u4e3a1\u30013\u30017\u7684\u5b50\u8bba\u575b\u4e2d\u641c\u7d22<br \/>\n$cl-&gt;SetFilter(\"forum_id\",array(1,3,7));<br \/>\n\/\/\u8303\u56f4\u7b5b\u9009<br \/>\n\/\/\u7b5b\u9009\u53d1\u5e03\u65f6\u95f4\u4e3a\u4eca\u5929,\u53c2\u6570\u4e3aint\u65f6\u95f4\u6233<br \/>\n$cl-&gt;SetFilterRange(\"s...<\/p>","author":"1","sortid":"-1","type":"blog","views":"484","comnum":"0","tbcount":"0","attnum":"0","top":"n","hide":"n","allow_remark":"y","allow_tb":"y","password":"","thumb":"0","alias":""}