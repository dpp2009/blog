{"gid":"496","title":"AjaxFileUpload","date":"1407103200","content":"\r\n <div> \r\n <pre>jQuery.extend({<br>\t\r\n\r\n    createUploadIframe: function(id, uri)\r\n\t{\r\n\t\t\t\/\/create frame\r\n            var frameId = 'jUploadFrame' + id;\r\n            var iframeHtml = '&lt;iframe id='' + frameId + '' name='' + frameId + '' style='position:absolute; top:-9999px; left:-9999px'';\r\n\t\t\tif(window.ActiveXObject)\r\n\t\t\t{\r\n                if(typeof uri== 'boolean'){\r\n\t\t\t\t\tiframeHtml += ' src='' + 'javascript:false' + ''';\r\n\r\n                }\r\n                else if(typeof uri== 'string'){\r\n\t\t\t\t\tiframeHtml += ' src='' + uri + ''';\r\n\r\n                }\t\r\n\t\t\t}\r\n\t\t\tiframeHtml += ' \/&gt;';\r\n\t\t\tjQuery(iframeHtml).appendTo(document.body);\r\n\r\n            return jQuery('#' + frameId).get(0);\t\t\t\r\n    },\r\n    createUploadForm: function(id, fileElementId)\r\n\t{\r\n\t\t\/\/create form\t\r\n\t\tvar formId = 'jUploadForm' + id;\r\n\t\tvar fileId = 'jUploadFile' + id;\r\n\t\tvar form = jQuery('&lt;form  action='' method='POST' name='' + formId + '' id='' + formId + '' enctype='multipart\/form-data'&gt;&lt;\/form&gt;');\t\r\n\t\tvar oldElement = jQuery('#' + fileElementId);\r\n\t\tvar newElement = jQuery(oldElement).clone();\r\n\t\tjQuery(oldElement).attr('id', fileId);\r\n\t\tjQuery(oldElement).before(newElement);\r\n\t\tjQuery(oldElement).appendTo(form);\r\n\t\t\/\/set attributes\r\n\t\tjQuery(form).css('position', 'absolute');\r\n\t\tjQuery(form).css('top', '-1200px');\r\n\t\tjQuery(form).css('left', '-1200px');\r\n\t\tjQuery(form).appendTo('body');\t\t\r\n\t\treturn form;\r\n    },\r\n\r\n    ajaxFileUpload: function(s) {\r\n        \/\/ TODO introduce global settings, allowing the client to modify them for all requests, not only timeout\t\t\r\n        s = jQuery.extend({}, jQuery.ajaxSettings, s);\r\n        var id = new Date().getTime()        \r\n\t\tvar form = jQuery.createUploadForm(id, s.fileElementId);\r\n\t\tvar io = jQuery.createUploadIframe(id, s.secureuri);\r\n\t\tvar frameId = 'jUploadFrame' + id;\r\n\t\tvar formId = 'jUploadForm' + id;\t\t\r\n        \/\/ Watch for a new set of requests\r\n        if ( s.global &amp;&amp; ! jQuery.active++ )\r\n\t\t{\r\n\t\t\tjQuery.event.trigger( 'ajaxStart' );\r\n\t\t}            \r\n        var requestDone = false;\r\n        \/\/ Create the request object\r\n        var xml = {}   \r\n        if ( s.global )\r\n            jQuery.event.trigger('ajaxSend', [xml, s]);\r\n        \/\/ Wait for a response to come back\r\n        var uploadCallback = function(isTimeout)\r\n\t\t{\t\t\t\r\n\t\t\tvar io = document.getElementById(frameId);\r\n            try \r\n\t\t\t{\t\t\t\t\r\n\t\t\t\tif(io.contentWindow)\r\n\t\t\t\t{\r\n\t\t\t\t\t xml.responseText = io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;\r\n                \t xml.responseXML = io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;\r\n\t\t\t\t\t \r\n\t\t\t\t}else if(io.contentDocument)\r\n\t\t\t\t{\r\n\t\t\t\t\t xml.responseText = io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;\r\n                \txml.responseXML = io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;\r\n\t\t\t\t}\t\t\t\t\t\t\r\n            }catch(e)\r\n\t\t\t{\r\n\t\t\t\tjQuery.handleError(s, xml, null, e);\r\n\t\t\t}\r\n            if ( xml || isTimeout == 'timeout') \r\n\t\t\t{\t\t\t\t\r\n                requestDone = true;\r\n                var status;\r\n                try {\r\n                    status = isTimeout != 'timeout' ? 'success' : 'error';\r\n                    \/\/ Make sure that the request was successful or notmodified\r\n                    if ( status != 'error' )\r\n\t\t\t\t\t{\r\n                        \/\/ process the data (runs the xml through httpData regardless of callback)\r\n                        var data = jQuery.uploadHttpData( xml, s.dataType );    \r\n                        \/\/ If a local callback was specified, fire it and pass it the data\r\n                        if ( s.success )\r\n                            s.success( data, status );\r\n    \r\n                        \/\/ Fire the global callback\r\n                        if( s.global )\r\n                            jQuery.event.trigger( 'ajaxSuccess', [xml, s] );\r\n                    } else\r\n                        jQuery.handleError(s, xml, status);\r\n                } catch(e) \r\n\t\t\t\t{\r\n                    status = 'error';\r\n                    jQuery.handleError(s, xml, status, e);\r\n                }\r\n\r\n                \/\/ The request was completed\r\n                if( s.global )\r\n                    jQuery.event.trigger( 'ajaxComplete', [xml, s] );\r\n\r\n                \/\/ Handle the global AJAX counter\r\n                if ( s.global &amp;&amp; ! --jQuery.active )\r\n                    jQuery.event.trigger( 'ajaxStop' );\r\n\r\n                \/\/ Process result\r\n                if ( s.complete )\r\n                    s.complete(xml, status);\r\n\r\n                jQuery(io).unbind()\r\n\r\n                setTimeout(function()\r\n\t\t\t\t\t\t\t\t\t{\ttry \r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tjQuery(io).remove();\r\n\t\t\t\t\t\t\t\t\t\t\tjQuery(form).remove();\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t} catch(e) \r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tjQuery.handleError(s, xml, null, e);\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t}, 100)\r\n\r\n                xml = null\r\n\r\n            }\r\n        }\r\n        \/\/ Timeout checker\r\n        if ( s.timeout &gt; 0 ) \r\n\t\t{\r\n            setTimeout(function(){\r\n                \/\/ Check to see if the request is still happening\r\n                if( !requestDone ) uploadCallback( 'timeout' );\r\n            }, s.timeout);\r\n        }\r\n        try \r\n\t\t{\r\n\r\n\t\t\tvar form = jQuery('#' + formId);\r\n\t\t\tjQuery(form).attr('action', s.url);\r\n\t\t\tjQuery(form).attr('method', 'POST');\r\n\t\t\tjQuery(form).attr('target', frameId);\r\n            if(form.encoding)\r\n\t\t\t{\r\n\t\t\t\tjQuery(form).attr('encoding', 'multipart\/form-data');      \t\t\t\r\n            }\r\n            else\r\n\t\t\t{\t\r\n\t\t\t\tjQuery(form).attr('enctype', 'multipart\/form-data');\t\t\t\r\n            }\t\t\t\r\n            jQuery(form).submit();\r\n\r\n        } catch(e) \r\n\t\t{\t\t\t\r\n            jQuery.handleError(s, xml, null, e);\r\n        }\r\n\t\t\r\n\t\tjQuery('#' + frameId).load(uploadCallback\t);\r\n        return {abort: function () {}};\t\r\n\r\n    },\r\n\r\n    uploadHttpData: function( r, type ) {\r\n        var data = !type;\r\n        data = type == 'xml' || data ? r.responseXML : r.responseText;\r\n        \/\/ If the type is 'script', eval it in global context\r\n        if ( type == 'script' )\r\n            jQuery.globalEval( data );\r\n        \/\/ Get the JavaScript object, if JSON is used.\r\n        if ( type == 'json' )\r\n            eval( 'data = ' + data );\r\n        \/\/ evaluate scripts within html\r\n        if ( type == 'html' )\r\n            jQuery('&lt;div&gt;').html(data).evalScripts();\r\n\r\n        return data;\r\n    }\r\n})\r\n<\/pre> \r\n <br> \r\n<\/div>\r\n ","excerpt":"\u00a0jQuery.extend({createUploadIframe:function(id,uri){\/\/createframevarframeId=\\'jUploadFrame\\'+id;variframe","author":"1","sortid":"19","type":"blog","views":"55","comnum":"0","tbcount":"0","attnum":"0","top":"n","hide":"n","allow_remark":"y","allow_tb":"y","password":"","thumb":"0","alias":""}