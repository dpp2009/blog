{"gid":"215","title":"[PHP]\u8bc6\u522b\u56fe\u7247\u4e3b\u8272\u8c03","date":"1428012000","content":"\r\n <span style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:\u5b8b\u4f53;font-size:20.7999992370605px;font-style:normal;font-weight:bold;text-align:center;'><\/span> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>\u4e00\u3001\u9002\u7528\u60c5\u666f\uff1a\uff0c\u6839\u636e\u989c\u8272\u5217\u51fa\u76f8\u5e94\u56fe\u7247\u3002<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'><img src='http:\/\/note.youdao.com\/yws\/res\/2791\/051A3FF6B9154B33BBECE986D55B7F20' style='width:564px;height:472px;' data-media-type='image'><br>\u4e8c\u3001\u4e3b\u7a0b\u5e8f\u53caAPI\u89e3\u91ca\uff1a<br>[php]&nbsp;<br>&lt;?php&nbsp;<br>&nbsp;<br>class MajorColor&nbsp;<br>{&nbsp;<br>&nbsp;&nbsp;&nbsp; \/\/\u53c2\u8003\u989c\u8272&nbsp;<br>&nbsp;&nbsp;&nbsp; protected $_colors = null;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; \/\/\u5bb9\u5dee&nbsp;<br>&nbsp;&nbsp;&nbsp; protected $_tolerance = 80;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; \/\/\u5ffd\u7565\u7684\u989c\u8272&nbsp;<br>&nbsp;&nbsp;&nbsp; protected $_ignoreColors = array();&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; \/\/\u652f\u6301\u7684\u56fe\u7247\u7c7b\u578b&nbsp;<br>&nbsp;&nbsp;&nbsp; protected $_funcs = array('image\/png' =&gt; 'imagecreatefrompng', 'image\/jpeg' =&gt; 'imagecreatefromjpeg', 'image\/gif' =&gt; 'imagecreatefromgif');&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function __construct(array $colors = null) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(null !== $colors) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_colors = $colors;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function setColors(array $colors) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_colors = $colors;&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function setTolerance($tolerance) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_tolerance = $tolerance;&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function setIgnoreColors($colors) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_ignoreColors = $colors;&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function _isValidColor($confVal, $val) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(is_array($confVal)) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $val &gt;= $confVal[0] &amp;&amp; $val &lt;= $confVal[1];&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $val &gt;= $confVal - $this-&gt;_tolerance &amp;&amp; $val &lt;= $confVal + $this-&gt;_tolerance;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function getOrderedColors($pic) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $size = getimagesize($pic);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!$size) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $width = $size[0];&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $height = $size[1];&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $mime = $size['mime'];&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $func = isset($this-&gt;_funcs[$mime]) ? $this-&gt;_funcs[$mime] : null;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!$func) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $im = $func($pic);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!$im) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $total = $width * $height;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nums = array();&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for($i = 0; $i &lt; $width; $i++) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for($m = 0; $m &lt; $height; $m++) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $color_index = imagecolorat($im, $i, $m);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $color_tran = imagecolorsforindex($im, $color_index);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $alpha = $color_tran['alpha'];&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unset($color_tran['alpha']);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(100 &lt; $alpha || in_array($color_tran, $this-&gt;_ignoreColors)) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; continue;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach ($this-&gt;_colors as $colorid =&gt; $color) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if($this-&gt;_isValidColor($color['red'], $color_tran['red'])&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; $this-&gt;_isValidColor($color['green'], $color_tran['green'])&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; $this-&gt;_isValidColor($color['blue'], $color_tran['blue'])&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nums[$colorid] = isset($nums[$colorid]) ? $nums[$colorid] + 1 : 1;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; imagedestroy($im);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arsort($nums);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $nums;&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; public function getMajorColor($pic) {&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nums = $this-&gt;getOrderedColors($pic);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $keys = array_keys($nums);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $keys[0];&nbsp;<br>&nbsp;&nbsp;&nbsp; }&nbsp;<br>}&nbsp;<br>1.void setColors(array $colors)<br>\u8bbe\u7f6e\u53ef\u9009\u989c\u8272\uff0c\u5373\u4e0a\u56fe\u4e2d\u201c\u5168\u90e8\u989c\u8272\u201d\u4e0b\u7684\u6240\u6709\u989c\u8272(\u767d\u3001\u7070\u3001\u9ed1...)<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>2.void setTolerance(int $tolerance)<br>\u8bbe\u7f6e\u5bb9\u5dee\uff0c\u6bd4\u5982\u7eff\u8272\u7684RGB\u503c\u4e3a(0,255,0)\uff0c\u5982\u679c\u8bbe\u7f6e\u5bb9\u5dee\u4e3a40\uff0c\u90a3\u4e48-40&lt;=R&lt;&lt;40 &amp;&amp; 215&lt;=G&lt;=295 &amp;&amp; -40&lt;=B&lt;=40\u8303\u56f4\u5185\u7684\u6240\u6709\u989c\u8272\u5c06\u88ab\u89c6\u4e3a\u7eff\u8272\u3002<br>\u6b64\u65b9\u6cd5\u7528\u4e8e\u5927\u81f4\u533a\u522b\u5404\u989c\u8272\u3002<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>3.void setIgnoreColors(array $colors)<br>\u8bbe\u7f6e\u4e0d\u9700\u8003\u8651\u7684\u989c\u8272\u3002\u5982\u5927\u591a\u56fe\u7247\u7684\u80cc\u666f\u662f\u767d\u8272\uff0c\u800c\u6211\u4eec\u663e\u7136\u4e0d\u5e0c\u671b\u7ed3\u679c\u662f\u767d\u8272\uff0c\u6b64\u65f6\u53ef\u8c03\u7528\u6b64\u65b9\u6cd5\u7b80\u7565\u767d\u8272\u3002<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>4.array getOrderedColors($pic)<br>\u6839\u636e$pic\u83b7\u53d6\u5404\u79cd\u989c\u8272(\u7528setColors\u8bbe\u7f6e\u7684\u989c\u8272)\u7684\u5339\u914d\u6570\u91cf\uff0c\u6309\u5339\u914d\u91cf\u7531\u9ad8\u5230\u4f4e\u6392\u5217<br>\u53c2\u6570$pic\u662f\u5f85\u68c0\u6d4b\u56fe\u7247\u7684\u8def\u5f84<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>5.mix getMajorColor($pic)<br>\u5185\u90e8\u8c03\u7528getOrderedColors\uff0c\u8fd4\u56de\u5339\u914d\u91cf\u6700\u9ad8\u7684\u989c\u8272\u7684key<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'>\u4e09\u3001$colors\u7684\u683c\u5f0f\u53ca\u8303\u56f4\u786e\u5b9a<br>1.\u5982\u679c$colors\u4e2d\u7684\u5404\u79cd\u989c\u8272\u5dee\u522b\u5f88\u660e\u663e\uff0c\u6211\u4eec\u53ea\u9700\u7b80\u5355\u7684\u4f20\u5165\u989c\u8272\u503c\uff0c\u5185\u90e8\u4f1a\u6839\u636esetTolerance\u8bbe\u7f6e\u7684\u5bb9\u5dee\u6765\u533a\u522b\u5404\u989c\u8272\u3002<br>[php]&nbsp;<br>$colors = array(&nbsp;<br>&nbsp;&nbsp;&nbsp; 1 =&gt; array('red' =&gt; 0xff, 'green' =&gt; 0xff, 'blue' =&gt; 0xff),&nbsp;<br>&nbsp;&nbsp;&nbsp; 2 =&gt; array('red' =&gt; 0xc0, 'green' =&gt; 0xc0, 'blue' =&gt; 0xc0),&nbsp;<br>&nbsp;&nbsp;&nbsp; 2 =&gt; array('red' =&gt; 0x00, 'green' =&gt; 0x00, 'blue' =&gt; 0x00),&nbsp;<br>);&nbsp;<\/p> \r\n<p style='background-color:rgb(255, 255, 255);color:rgb(51, 51, 51);font-family:\u5b8b\u4f53;font-size:14.3999996185303px;font-style:normal;font-weight:normal;text-align:start;'><br>2.setTolerance\u8bbe\u7f6e\u5bb9\u5dee\u7684\u65b9\u6cd5\u53ea\u80fd\u5927\u81f4\u533a\u5206\u5404\u79cd\u989c\u8272\uff0c\u5982\u679c\u9700\u8981\u66f4\u7cbe\u786e\u7684\u63a7\u5236\uff0c\u5219\u9700\u8981\u5206\u522b\u8bbe\u7f6e\u67d0\u4e00\u989c\u8272\u7684R\u3001G\u3001B\u8303\u56f4<a href='http:\/\/www.2cto.com\/' style='color:rgb(51, 51, 51);font-size:14px;'>www.2cto.com<\/a><br>[php]&nbsp;<br>$colors = array(&nbsp;<br>&nbsp;&nbsp;&nbsp; 1 =&gt; array('red' =&gt; array(189, 230), 'green' =&gt; array(189, 230), 'blue' =&gt; array(189, 230)),&nbsp;<br>&nbsp;&nbsp;&nbsp; 2 =&gt; array('red' =&gt; array(0, 37), 'green' =&gt; array(0, 37), 'blue' =&gt; array(0, 37)),&nbsp;<br>&nbsp;&nbsp;&nbsp; 3 =&gt; array('red' =&gt; array(128, 255), 'green' =&gt; array(0, 76), 'blue' =&gt; array(0, 100)),&nbsp;<br>);&nbsp;<br>\u9700\u8981\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u5fae\u8c03\uff0c\u76f4\u81f3\u80fd\u660e\u663e\u533a\u5206\u5404\u79cd\u989c\u8272\u3002<br>\u4f5c\u8005\uff1axiaodao1986<\/p> \r\n<div> \r\n <br> \r\n<\/div>\r\n ","excerpt":"\u00a0\u4e00\u3001\u9002\u7528\u60c5\u666f\uff1a\uff0c\u6839\u636e\u989c\u8272\u5217\u51fa\u76f8\u5e94\u56fe\u7247\u3002\u4e8c\u3001\u4e3b\u7a0b\u5e8f\u53caAPI\u89e3\u91ca\uff1a[php]<?phpclassMajorColor{\/\/\u53c2\u8003\u989c\u8272protected$_colors=null;\/\/\u5bb9\u5deeprotected$_tolerance=80;","author":"1","sortid":"19","type":"blog","views":"85","comnum":"0","tbcount":"0","attnum":"0","top":"n","hide":"n","allow_remark":"y","allow_tb":"y","password":"","thumb":"0","alias":""}