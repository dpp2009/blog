<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Linuxtcpdump命令详解</title>
<meta name="keywords" content="迷茫,dpp,丁盼盼,迷茫者" />
<meta name="description" content="" />
<meta name="generator" content="emlog" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://onelose.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://onelose.com/wlwmanifest.xml" />
<link rel="alternate" type="application/rss+xml" title="RSS"  href="http://onelose.com/rss.php" />
<link href="http://onelose.com/content/templates/dpp_icecream_02/main.css" rel="stylesheet" type="text/css" />
<link href="http://onelose.com/admin/editor/plugins/code/prettify.css" rel="stylesheet" type="text/css" />
<script src="http://onelose.com/admin/editor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="http://onelose.com/include/lib/js/common_tpl.js" type="text/javascript"></script>
<script src="http://onelose.com/content/templates/dpp_icecream_02/js/nav.js" type="text/javascript"></script>
<script src="http://onelose.com/content/templates/dpp_icecream_02/js/jquery-1.10.2.min.js"></script>
<script id="allmobilize" charset="utf-8" src="http://a.yunshipei.com/cbca8680e2150f433cb28b942e85ec26/allmobilize.min.js"></script><meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />
<script src="http://onelose.com/include/lib/js/jquery/jquery-1.7.1.js" type="text/javascript"></script><link rel="stylesheet" type="text/css" href ="http://onelose.com/content/plugins/SHJS_for_Emlog/sh_style.min.css" />
	<script type="text/javascript" src="http://onelose.com/content/plugins/et_highlighter51/scripts/brush.js"></script>
	<link type="text/css" rel="stylesheet" href="http://onelose.com/content/plugins/et_highlighter51/styles/shCore.css"/>
	<link type="text/css" rel="stylesheet" href="http://onelose.com/content/plugins/et_highlighter51/styles/shThemeDefault.css"/>
	<script type="text/javascript">SyntaxHighlighter.config.clipboardSwf = 'http://onelose.com/content/plugins/et_highlighter51/scripts/clipboard.swf';SyntaxHighlighter.all();</script>
	</head>
<body>

<div id="wrap">
<div id="hm">
	<div id="header">
	<div><a href="http://onelose.com/"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/logo.jpg" alt="迷茫者 " title="迷茫者"></a></div>
	<h3>迷茫者王者归来。</h3>
	</div>
	<!-- <div id="banner"><a href="http://onelose.com/"><img src="http://onelose.com/content/templates/default/images/top/terrace.jpg" height="134" width="960" /></a></div> -->
	<div id="nav" >	<ul>
			<li class="common"><a href="http://onelose.com/" >首页</a></li>
			<li class="common"><a href="http://onelose.com/t" >微语</a></li>
			<li class="common"><a href="http://onelose.com/post-113.html" >留言</a></li>
			<li class="common"><a href="http://onelose.com/admin" >登录</a></li>
		</ul>
</div>
</div>
<div id="content">
<div id="contentleft">
	<h2>Linuxtcpdump命令详解</h2>
	<p class="date">作者：<a href="http://onelose.com/author/1" title="及尽繁华 不过一掬细沙 只望淡泊名利 自在一生 奈何凡尘俗世之杂碎琐事 竟有我舍之不去的牵挂 故 始终俗人！ 1064490567@qq.com">迷茫者</a> 发布于：2015-3-9 7:00 Monday 
			分类：<a href="http://onelose.com/sort/youdao">有道云笔记</a>
	 	</p>
	
 <div> 
 <a href='http://www.cnblogs.com/ggjucheng/archive/2012/01/14/2322659.html' style='color:navy;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:bold;text-align:start;'></a> 
 <div style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'> 
  <a href='http://www.cnblogs.com/ggjucheng/archive/2012/01/14/2322659.html' style='color:navy;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:bold;text-align:start;'><h1 style='font-size:28px;font-weight:bold;'><strong><span style='font-size:18pt;'>简介</span></strong></h1></a><p style='font-size:13px;'>用简单的话来定义tcpdump，就是：dump the traffic on a network，根据使用者的定义对网络上的数据包进行截获的包分析工具。&nbsp;tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息。</p><p style='font-size:13px;'>&nbsp;</p><h1 style='font-size:28px;font-weight:bold;'><span style='font-size:18pt;'><strong><span data-mce-=''>实用命令实例</span></strong></span></h1><p style='font-size:13px;'><span style='font-size:16px;'><strong>默认启动</strong></span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump</pre> 
   </div><p style='font-size:13px;'><span>普通情况下，直接启动</span><span lang='EN-US'>tcpdump</span><span>将监视第一个网络接口上所有流过的数据包。</span></p><p style='font-size:13px;'><span>&nbsp;</span></p><p style='font-size:13px;'><span style='font-size:16px;'><strong>监视指定网络接口的数据包</strong></span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump -i eth1</pre> 
   </div><p style='font-size:13px;'>如果不指定网卡，默认tcpdump只会监视第一个网络接口，一般是eth0，下面的例子都没有指定网络接口。　</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'><span style='font-size:16px;'><strong>监视指定主机的数据包</strong></span></p><p style='font-size:13px;'>打印所有进入或离开sundown的数据包.</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump host sundown</pre> 
   </div><p style='font-size:13px;'>也可以指定ip,例如<span>截获所有</span><span lang='EN-US'>210.27.48.1&nbsp;</span><span>的主机收到的和发出的所有的数据包</span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump host <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>210.27</span>.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>48.1</span> </pre> 
   </div><p style='font-size:13px;'>打印helios 与 hot 或者与 ace 之间通信的数据包</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump host helios and \( hot or ace \)</pre> 
   </div><p style='font-size:13px;'><span>截获主机</span><span lang='EN-US'>210.27.48.1&nbsp;</span><span>和主机</span><span lang='EN-US'>210.27.48.2&nbsp;</span><span>或</span><span lang='EN-US'>210.27.48.3</span><span>的通信</span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump host 210.27.48.1 and \ (210.27.48.2 or 210.27.48.3 \) </pre> 
   </div><p style='font-size:13px;'>打印ace与任何其他主机之间通信的IP 数据包, 但不包括与helios之间的数据包.</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump ip host ace and not helios</pre> 
   </div><p style='font-size:13px;'>如果想要获取主机<span lang='EN-US'>210.27.48.1</span>除了和主机<span lang='EN-US'>210.27.48.2</span>之外所有主机通信的<span lang='EN-US'>ip</span>包，使用命令：</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump ip host 210.27.48.1 and ! 210.27.48.2</pre> 
   </div><p style='font-size:13px;'>截获主机<span lang='EN-US'>hostname</span>发送的所有数据</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump -i eth0 src host hostname</pre> 
   </div><p style='font-size:13px;'>监视所有送到主机<span lang='EN-US'>hostname</span>的数据包</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump -i eth0 dst host hostname</pre> 
   </div><p style='font-size:13px;'><strong><span>&nbsp;</span></strong></p><p style='font-size:13px;'><span style='font-size:16px;'><strong>监视指定主机和端口的数据包</strong></span></p><p style='font-size:13px;'><span>如果想要获取主机</span><span lang='EN-US'>210.27.48.1</span><span>接收或发出的</span><span lang='EN-US'>telnet</span><span>包，使用如下命令</span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump tcp port <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>23 and</span> host <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>210.27</span>.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>48.1</span></pre> 
   </div><p style='font-size:13px;'><span>对本机的</span><span lang='EN-US'>udp 123&nbsp;</span><span>端口进行监视</span><span lang='EN-US'>&nbsp;123&nbsp;</span><span>为</span><span lang='EN-US'>ntp</span><span>的服务端口</span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump udp port 123 </pre> 
   </div><p style='font-size:13px;'><span>&nbsp;</span></p><p style='font-size:13px;'><span style='font-size:16px;'><strong>监视指定网络的数据包</strong></span></p><p style='font-size:13px;'>打印本地主机与Berkeley网络上的主机之间的所有通信数据包(nt: ucb-ether, 此处可理解为'Berkeley网络'的网络地址,此表达式最原始的含义可表达为: 打印网络地址为ucb-ether的所有数据包)</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump net ucb-ether</pre> 
   </div><p style='font-size:13px;'>打印所有通过网关snup的ftp数据包(注意, 表达式被单引号括起来了, 这可以防止shell对其中的括号进行错误解析)</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>gateway snup and (port ftp or ftp-data)</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'>打印所有源地址或目标地址是本地主机的IP数据包</p><p style='font-size:13px;'>(如果本地网络通过网关连到了另一网络, 则另一网络并不能算作本地网络.(nt: 此句翻译曲折,需补充).localnet 实际使用时要真正替换成本地网络的名字)</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump ip and not net localnet</pre> 
   </div><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'><span style='font-size:16px;'><strong>监视指定协议的数据包</strong></span></p><p style='font-size:13px;'>打印TCP会话中的的开始和结束数据包, 并且数据包的源或目的不是本地网络上的主机.(nt: localnet, 实际使用时要真正替换成本地网络的名字))</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>tcp[tcpflags] &amp; (tcp-syn|tcp-fin) != 0 and not src and dst net localnet</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'>打印所有源或目的端口是80, 网络层协议为IPv4, 并且含有数据,而不是SYN,FIN以及ACK-only等不含数据的数据包.(ipv6的版本的表达式可做练习)</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'>(nt: 可理解为, ip[2:2]表示整个ip数据包的长度, (ip[0]&amp;0xf)&lt;&lt;2)表示ip数据包包头的长度(ip[0]&amp;0xf代表包中的IHL域, 而此域的单位为32bit, 要换算</p><p style='font-size:13px;'>成字节数需要乘以4,　即左移2.　(tcp[12]&amp;0xf0)&gt;&gt;4 表示tcp头的长度, 此域的单位也是32bit,　换算成比特数为 ((tcp[12]&amp;0xf0) &gt;&gt; 4)　&lt;&lt;　２,　<br>即 ((tcp[12]&amp;0xf0)&gt;&gt;2).　((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0　表示: 整个ip数据包的长度减去ip头的长度,再减去<br>tcp头的长度不为0, 这就意味着, ip数据包中确实是有数据.对于ipv6版本只需考虑ipv6头中的'Payload Length' 与 'tcp头的长度'的差值, 并且其中表达方式'ip[]'需换成'ip6[]'.)</p><p style='font-size:13px;'>打印长度超过576字节, 并且网关地址是snup的IP数据包</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>gateway snup and ip[2:2] &gt; 576</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'>打印所有IP层广播或多播的数据包， 但不是物理以太网层的广播或多播数据报</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>ether[0] &amp; 1 = 0 and ip[16] &gt;= 224</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'>打印除'echo request'或者'echo reply'类型以外的ICMP数据包( 比如,需要打印所有非ping 程序产生的数据包时可用到此表达式 .<br>(nt: 'echo reuqest' 与 'echo reply' 这两种类型的ICMP数据包通常由ping程序产生))</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump <span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply</span><span data-mce-='' style='font-family:'Courier New' !important;font-size:12px !important;'>'</span></pre> 
   </div><p style='font-size:13px;'><strong><span style='font-size:14px;'>&nbsp;</span></strong></p><p style='font-size:13px;'><span style='font-size:16px;'><strong>tcpdump 与wireshark</strong></span></p><p style='font-size:13px;'>Wireshark(以前是ethereal)是Windows下非常简单易用的抓包工具。但在Linux下很难找到一个好用的图形化抓包工具。<br>还好有Tcpdump。我们可以用Tcpdump + Wireshark 的完美组合实现：在 Linux 里抓包，然后在Windows 里分析包。</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap</pre> 
   </div><p style='font-size:13px;'>(1)tcp: ip icmp arp rarp 和 tcp、udp、icmp这些选项等都要放到第一个参数的位置，用来过滤数据报的类型<br>(2)-i eth1 : 只抓经过接口eth1的包<br>(3)-t : 不显示时间戳<br>(4)-s 0 : 抓取数据包时默认抓取长度为68字节。加上-S 0 后可以抓到完整的数据包<br>(5)-c 100 : 只抓取100个数据包<br>(6)dst port ! 22 : 不抓取目标端口是22的数据包<br>(7)src net 192.168.1.0/24 : 数据包的源网络地址为192.168.1.0/24<br>(8)-w ./target.cap : 保存成cap文件，方便用ethereal(即wireshark)分析</p><p style='font-size:13px;'><strong><span style='font-size:14px;'>&nbsp;</span></strong></p><p style='font-size:13px;'><span style='font-size:16px;'><strong>使用tcpdump抓取HTTP包</strong></span></p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump  -XvvennSs 0 -i eth0 tcp[20:2]=0x4745 or tcp[20:2]=0x4854</pre> 
   </div><p style='font-size:13px;'><span>0x4745 为'GET'前两个字母'GE',</span>0x4854 为'HTTP'前两个字母'HT'。</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'>tcpdump 对截获的数据并没有进行彻底解码，数据包内的大部分内容是使用十六进制的形式直接打印输出的。显然这不利于分析网络故障，通常的解决办法是先使用带-w参数的tcpdump 截获数据并保存到文件中，然后再使用其他程序(如Wireshark)进行解码分析。当然也应该定义过滤规则，以避免捕获的数据包填满整个硬盘。</p><p style='font-size:13px;'>&nbsp;</p><h1 style='font-size:28px;font-weight:bold;'><strong><span style='font-size:18pt;'>输出信息含义</span></strong></h1><p style='font-size:13px;'>首先我们注意一下，基本上tcpdump总的的输出格式为：系统时间 来源主机.端口 &gt; 目标主机.端口 数据包参数</p><p style='font-size:13px;'>tcpdump 的输出格式与协议有关.以下简要描述了大部分常用的格式及相关例子.</p><h2 style='font-size:21px;font-weight:bold;'><span style='font-size:14pt;'><strong>链路层头</strong></span></h2><p style='font-size:13px;'>对于FDDI网络, '-e' 使tcpdump打印出指定数据包的'frame control' 域, 源和目的地址, 以及包的长度.(frame control域<br>控制对包中其他域的解析). 一般的包(比如那些IP datagrams)都是带有'async'(异步标志)的数据包，并且有取值0到7的优先级;<br>比如 'async4'就代表此包为异步数据包，并且优先级别为4. 通常认为,这些包们会内含一个 LLC包(逻辑链路控制包); 这时,如果此包<br>不是一个ISO datagram或所谓的SNAP包，其LLC头部将会被打印(nt:应该是指此包内含的 LLC包的包头).</p><p style='font-size:13px;'>对于Token Ring网络(令牌环网络), '-e' 使tcpdump打印出指定数据包的'frame control'和'access control'域, 以及源和目的地址,<br>外加包的长度. 与FDDI网络类似, 此数据包通常内含LLC数据包. 不管 是否有'-e'选项.对于此网络上的'source-routed'类型数据包(nt:<br>意译为:源地址被追踪的数据包,具体含义未知,需补充), 其包的源路由信息总会被打印.</p><p style='font-size:13px;'><br>对于802.11网络(WLAN,即wireless local area network), '-e' 使tcpdump打印出指定数据包的'frame control域,<br>包头中包含的所有地址, 以及包的长度.与FDDI网络类似, 此数据包通常内含LLC数据包.</p><p style='font-size:13px;'>(注意: 以下的描述会假设你熟悉SLIP压缩算法 (nt:SLIP为Serial Line Internet Protocol.), 这个算法可以在<br>RFC-1144中找到相关的蛛丝马迹.)</p><p style='font-size:13px;'>对于SLIP网络(nt:SLIP links, 可理解为一个网络, 即通过串行线路建立的连接, 而一个简单的连接也可看成一个网络),<br>数据包的'direction indicator'('方向指示标志')('I'表示入, 'O'表示出), 类型以及压缩信息将会被打印. 包类型会被首先打印.</p><p style='font-size:13px;'>类型分为ip, utcp以及ctcp(nt:未知, 需补充). 对于ip包,连接信息将不被打印(nt:SLIP连接上,ip包的连接信息可能无用或没有定义.<br>reconfirm).对于TCP数据包, 连接标识紧接着类型表示被打印. 如果此包被压缩, 其被编码过的头部将被打印.<br>此时对于特殊的压缩包,会如下显示:<br>*S+n 或者 *SA+n, 其中n代表包的(顺序号或(顺序号和应答号))增加或减少的数目(nt | rt:S,SA拗口, 需再译).<br>对于非特殊的压缩包,0个或更多的'改变'将会被打印.'改变'被打印时格式如下:<br>'标志'+/-/=n 包数据的长度 压缩的头部长度.<br>其中'标志'可以取以下值:<br>U(代表紧急指针), W(指缓冲窗口), A(应答), S(序列号), I(包ID),而增量表达'=n'表示被赋予新的值, +/-表示增加或减少.</p><p style='font-size:13px;'>比如, 以下显示了对一个外发压缩TCP数据包的打印, 这个数据包隐含一个连接标识(connection identifier); 应答号增加了6,<br>顺序号增加了49, 包ID号增加了6; 包数据长度为3字节(octect), 压缩头部为6字节.(nt:如此看来这应该不是一个特殊的压缩数据包).</p><p style='font-size:13px;'>ARP/RARP 数据包</p><p style='font-size:13px;'>tcpdump对Arp/rarp包的输出信息中会包含请求类型及该请求对应的参数. 显示格式简洁明了. 以下是从主机rtsg到主机csam的'rlogin'<br>(远程登录)过程开始阶段的数据包样例:<br>arp who-has csam tell rtsg<br>arp reply csam is-at CSAM<br>第一行表示:rtsg发送了一个arp数据包(nt:向全网段发送,arp数据包）以询问csam的以太网地址<br>Csam（nt:可从下文看出来, 是Csam）以她自己的以太网地址做了回应(在这个例子中, 以太网地址以大写的名字标识, 而internet<br>地址(即ip地址)以全部的小写名字标识).</p><p style='font-size:13px;'>如果使用tcpdump -n, 可以清晰看到以太网以及ip地址而不是名字标识:<br>arp who-has 128.3.254.6 tell 128.3.254.68<br>arp reply 128.3.254.6 is-at 02:07:01:00:01:c4</p><p style='font-size:13px;'>如果我们使用tcpdump -e, 则可以清晰的看到第一个数据包是全网广播的, 而第二个数据包是点对点的:<br>RTSG Broadcast 0806 64: arp who-has csam tell rtsg<br>CSAM RTSG 0806 64: arp reply csam is-at CSAM<br>第一个数据包表明:以arp包的源以太地址是RTSG, 目标地址是全以太网段, type域的值为16进制0806(表示ETHER_ARP(nt:arp包的类型标识)),<br>包的总长度为64字节.</p><h2 style='font-size:21px;font-weight:bold;'><span style='font-size:14pt;'><strong>TCP 数据包</strong></span></h2><p style='font-size:13px;'>(注意:以下将会假定你对 RFC-793所描述的TCP熟悉. 如果不熟, 以下描述以及tcpdump程序可能对你帮助不大.(nt:警告可忽略,<br>只需继续看, 不熟悉的地方可回头再看.).</p><p style='font-size:13px;'><br>通常tcpdump对tcp数据包的显示格式如下:<br>src &gt; dst: flags data-seqno ack window urgent options</p><p style='font-size:13px;'>src 和 dst 是源和目的IP地址以及相应的端口. flags 标志由S(SYN), F(FIN), P(PUSH, R(RST),<br>W(ECN CWT(nt | rep:未知, 需补充))或者 E(ECN-Echo(nt | rep:未知,　需补充))组成,<br>单独一个'.'表示没有flags标识. 数据段顺序号(Data-seqno)描述了此包中数据所对应序列号空间中的一个位置(nt:整个数据被分段,<br>每段有一个顺序号, 所有的顺序号构成一个序列号空间)(可参考以下例子). Ack 描述的是同一个连接,同一个方向,下一个本端应该接收的<br>(对方应该发送的)数据片段的顺序号. Window是本端可用的数据接收缓冲区的大小(也是对方发送数据时需根据这个大小来组织数据).<br>Urg(urgent) 表示数据包中有紧急的数据. options 描述了tcp的一些选项, 这些选项都用尖括号来表示(如 &lt;mss 1024&gt;).</p><p style='font-size:13px;'>src, dst 和 flags 这三个域总是会被显示. 其他域的显示与否依赖于tcp协议头里的信息.</p><p style='font-size:13px;'>这是一个从trsg到csam的一个rlogin应用登录的开始阶段.<br>rtsg.1023 &gt; csam.login: S 768512:768512(0) win 4096 &lt;mss 1024&gt;<br>csam.login &gt; rtsg.1023: S 947648:947648(0) ack 768513 win 4096 &lt;mss 1024&gt;<br>rtsg.1023 &gt; csam.login: . ack 1 win 4096<br>rtsg.1023 &gt; csam.login: P 1:2(1) ack 1 win 4096<br>csam.login &gt; rtsg.1023: . ack 2 win 4096<br>rtsg.1023 &gt; csam.login: P 2:21(19) ack 1 win 4096<br>csam.login &gt; rtsg.1023: P 1:2(1) ack 21 win 4077<br>csam.login &gt; rtsg.1023: P 2:3(1) ack 21 win 4077 urg 1<br>csam.login &gt; rtsg.1023: P 3:4(1) ack 21 win 4077 urg 1<br>第一行表示有一个数据包从rtsg主机的tcp端口1023发送到了csam主机的tcp端口login上(nt:udp协议的端口和tcp协议的端<br>口是分别的两个空间, 虽然取值范围一致). S表示设置了SYN标志. 包的顺序号是768512, 并且没有包含数据.(表示格式<br>为:'first:last(nbytes)', 其含义是'此包中数据的顺序号从first开始直到last结束，不包括last. 并且总共包含nbytes的<br>用户数据'.) 没有捎带应答(nt:从下文来看，第二行才是有捎带应答的数据包), 可用的接受窗口的大小为4096bytes, 并且请求端(rtsg)<br>的最大可接受的数据段大小是1024字节(nt:这个信息作为请求发向应答端csam, 以便双方进一步的协商).</p><p style='font-size:13px;'>Csam 向rtsg 回复了基本相同的SYN数据包, 其区别只是多了一个' piggy-backed ack'(nt:捎带回的ack应答, 针对rtsg的SYN数据包).</p><p style='font-size:13px;'>rtsg 同样针对csam的SYN数据包回复了一ACK数据包作为应答. '.'的含义就是此包中没有标志被设置. 由于此应答包中不含有数据, 所以<br>包中也没有数据段序列号. 提醒! 此ACK数据包的顺序号只是一个小整数1. 有如下解释:tcpdump对于一个tcp连接上的会话, 只打印会话两端的<br>初始数据包的序列号,其后相应数据包只打印出与初始包序列号的差异.即初始序列号之后的序列号,　可被看作此会话上当前所传数据片段在整个<br>要传输的数据中的'相对字节'位置(nt:双方的第一个位置都是1, 即'相对字节'的开始编号).　'-Ｓ'将覆盖这个功能,　<br>使数据包的原始顺序号被打印出来.</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'>第六行的含义为:rtsg 向 csam发送了19字节的数据(字节的编号为2到20，传送方向为rtsg到csam). 包中设置了PUSH标志. 在第7行,<br>csam 喊到， 她已经从rtsg中收到了21以下的字节, 但不包括21编号的字节. 这些字节存放在csam的socket的接收缓冲中, 相应地,<br>csam的接收缓冲窗口大小会减少19字节(nt:可以从第5行和第7行win属性值的变化看出来). csam在第7行这个包中也向rtsg发送了一个<br>字节. 在第8行和第9行, csam 继续向rtsg 分别发送了两个只包含一个字节的数据包, 并且这个数据包带PUSH标志.</p><p style='font-size:13px;'>如果所抓到的tcp包(nt:即这里的snapshot)太小了，以至tcpdump无法完整得到其头部数据, 这时, tcpdump会尽量解析这个不完整的头,<br>并把剩下不能解析的部分显示为'[|tcp]'. 如果头部含有虚假的属性信息(比如其长度属性其实比头部实际长度长或短), tcpdump会为该头部<br>显示'[bad opt]'. 如果头部的长度告诉我们某些选项(nt | rt:从下文来看， 指tcp包的头部中针对ip包的一些选项, 回头再翻)会在此包中,<br>而真正的IP(数据包的长度又不够容纳这些选项, tcpdump会显示'[bad hdr length]'.</p><p style='font-size:13px;'><br>抓取带有特殊标志的的TCP包(如SYN-ACK标志, URG-ACK标志等).</p><p style='font-size:13px;'>在TCP的头部中, 有8比特(bit)用作控制位区域, 其取值为:<br>CWR | ECE | URG | ACK | PSH | RST | SYN | FIN<br>(nt | rt:从表达方式上可推断:这8个位是用或的方式来组合的, 可回头再翻)</p><p style='font-size:13px;'>现假设我们想要监控建立一个TCP连接整个过程中所产生的数据包. 可回忆如下:TCP使用3次握手协议来建立一个新的连接; 其与此三次握手<br>连接顺序对应，并带有相应TCP控制标志的数据包如下:<br>1) 连接发起方(nt:Caller)发送SYN标志的数据包<br>2) 接收方(nt:Recipient)用带有SYN和ACK标志的数据包进行回应<br>3) 发起方收到接收方回应后再发送带有ACK标志的数据包进行回应</p><p style='font-size:13px;'><br>0 15 31<br>-----------------------------------------------------------------<br>| source port | destination port |<br>-----------------------------------------------------------------<br>| sequence number |<br>-----------------------------------------------------------------<br>| acknowledgment number |<br>-----------------------------------------------------------------<br>| HL | rsvd |C|E|U|A|P|R|S|F| window size |<br>-----------------------------------------------------------------<br>| TCP checksum | urgent pointer |<br>-----------------------------------------------------------------</p><p style='font-size:13px;'>一个TCP头部,在不包含选项数据的情况下通常占用20个字节(nt | rt:options 理解为选项数据，需回译). 第一行包含0到3编号的字节,<br>第二行包含编号4-7的字节.</p><p style='font-size:13px;'>如果编号从0开始算, TCP控制标志位于13字节(nt:第四行左半部分).</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'>0 7| 15| 23| 31<br>----------------|---------------|---------------|----------------<br>| HL | rsvd |C|E|U|A|P|R|S|F| window size |<br>----------------|---------------|---------------|----------------<br>| | 13th octet | | |</p><p style='font-size:13px;'>让我们仔细看看编号13的字节:</p><p style='font-size:13px;'>| |<br>|---------------|<br>|C|E|U|A|P|R|S|F|<br>|---------------|<br>|7 5 3 0|</p><p style='font-size:13px;'><br>这里有我们感兴趣的控制标志位. 从右往左这些位被依次编号为0到7, 从而 PSH位在3号, 而URG位在5号.</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'>提醒一下自己, 我们只是要得到包含SYN标志的数据包. 让我们看看在一个包的包头中, 如果SYN位被设置, 到底<br>在13号字节发生了什么:</p><p style='font-size:13px;'>|C|E|U|A|P|R|S|F|<br>|---------------|<br>|0 0 0 0 0 0 1 0|<br>|---------------|<br>|7 6 5 4 3 2 1 0|</p><p style='font-size:13px;'><br>在控制段的数据中, 只有比特1(bit number 1)被置位.</p><p style='font-size:13px;'>假设编号为13的字节是一个8位的无符号字符型,并且按照网络字节号排序(nt:对于一个字节来说，网络字节序等同于主机字节序), 其二进制值<br>如下所示:<br>00000010</p><p style='font-size:13px;'>并且其10进制值为:</p><p style='font-size:13px;'>0*2^7 + 0*2^6 + 0*2^5 + 0*2^4 + 0*2^3 + 0*2^2 + 1*2^1 + 0*2^0 = 2(nt: 1 * 2^6 表示1乘以2的6次方, 也许这样更<br>清楚些, 即把原来表达中的指数7 6 ... 0挪到了下面来表达)</p><p style='font-size:13px;'>接近目标了, 因为我们已经知道, 如果数据包头部中的SYN被置位, 那么头部中的第13个字节的值为2(nt: 按照网络序, 即大头方式, 最重要的字节<br>在前面(在前面,即该字节实际内存地址比较小, 最重要的字节,指数学表示中数的高位, 如356中的3) ).</p><p style='font-size:13px;'>表达为tcpdump能理解的关系式就是:<br>tcp[13] 2</p><p style='font-size:13px;'>从而我们可以把此关系式当作tcpdump的过滤条件, 目标就是监控只含有SYN标志的数据包:<br>tcpdump -i xl0 tcp[13] 2 (nt: xl0 指网络接口, 如eth0)</p><p style='font-size:13px;'>这个表达式是说'让TCP数据包的第13个字节拥有值2吧', 这也是我们想要的结果.</p><p style='font-size:13px;'><br>现在, 假设我们需要抓取带SYN标志的数据包, 而忽略它是否包含其他标志.(nt:只要带SYN就是我们想要的). 让我们来看看当一个含有<br>SYN-ACK的数据包(nt:SYN 和 ACK 标志都有), 来到时发生了什么:<br>|C|E|U|A|P|R|S|F|<br>|---------------|<br>|0 0 0 1 0 0 1 0|<br>|---------------|<br>|7 6 5 4 3 2 1 0|</p><p style='font-size:13px;'>13号字节的1号和4号位被置位, 其二进制的值为:<br>00010010</p><p style='font-size:13px;'>转换成十进制就是:</p><p style='font-size:13px;'>0*2^7 + 0*2^6 + 0*2^5 + 1*2^4 + 0*2^3 + 0*2^2 + 1*2^1 + 0*2 = 18(nt: 1 * 2^6 表示1乘以2的6次方, 也许这样更<br>清楚些, 即把原来表达中的指数7 6 ... 0挪到了下面来表达)</p><p style='font-size:13px;'>现在, 却不能只用'tcp[13] 18'作为tcpdump的过滤表达式, 因为这将导致只选择含有SYN-ACK标志的数据包, 其他的都被丢弃.<br>提醒一下自己, 我们的目标是: 只要包的SYN标志被设置就行, 其他的标志我们不理会.</p><p style='font-size:13px;'>为了达到我们的目标, 我们需要把13号字节的二进制值与其他的一个数做AND操作(nt:逻辑与)来得到SYN比特位的值. 目标是:只要SYN 被设置<br>就行, 于是我们就把她与上13号字节的SYN值(nt: 00000010).</p><p style='font-size:13px;'>00010010 SYN-ACK 00000010 SYN<br>AND 00000010 (we want SYN) AND 00000010 (we want SYN)<br>-------- --------<br>= 00000010 = 00000010</p><p style='font-size:13px;'>我们可以发现, 不管包的ACK或其他标志是否被设置, 以上的AND操作都会给我们相同的值, 其10进制表达就是2(2进制表达就是00000010).<br>从而我们知道, 对于带有SYN标志的数据包, 以下的表达式的结果总是真(true):</p><p style='font-size:13px;'>( ( value of octet 13 ) AND ( 2 ) ) ( 2 ) (nt: value of octet 13, 即13号字节的值)</p><p style='font-size:13px;'>灵感随之而来, 我们于是得到了如下的tcpdump 的过滤表达式<br>tcpdump -i xl0 'tcp[13] &amp; 2 2'</p><p style='font-size:13px;'>注意, 单引号或反斜杆(nt: 这里用的是单引号)不能省略, 这可以防止shell对&amp;的解释或替换.</p><h2 style='font-size:21px;font-weight:bold;'><br><span style='font-size:14pt;'><strong>UDP 数据包</strong></span></h2><p style='font-size:13px;'>UDP 数据包的显示格式，可通过rwho这个具体应用所产生的数据包来说明:<br>actinide.who &gt; broadcast.who: udp 84</p><p style='font-size:13px;'>其含义为:actinide主机上的端口who向broadcast主机上的端口who发送了一个udp数据包(nt: actinide和broadcast都是指Internet地址).<br>这个数据包承载的用户数据为84个字节.</p><p style='font-size:13px;'>一些UDP服务可从数据包的源或目的端口来识别，也可从所显示的更高层协议信息来识别. 比如, Domain Name service requests(DNS 请求,<br>在RFC-1034/1035中), 和Sun RPC calls to NFS(对NFS服务器所发起的远程调用(nt: 即Sun RPC)，在RFC-1050中有对远程调用的描述).</p><p style='font-size:13px;'>UDP 名称服务请求</p><p style='font-size:13px;'>(注意:以下的描述假设你对Domain Service protoco(nt:在RFC-103中有所描述), 否则你会发现以下描述就是天书(nt:希腊文天书,<br>不必理会, 吓吓你的, 接着看就行))</p><p style='font-size:13px;'>名称服务请求有如下的格式:<br>src &gt; dst: id op? flags qtype qclass name (len)<br>(nt: 从下文来看, 格式应该是src &gt; dst: id op flags qtype qclass? name (len))<br>比如有一个实际显示为:<br>h2opolo.1538 &gt; helios.domain: 3+ A? ucbvax.berkeley.edu. (37)</p><p style='font-size:13px;'>主机h2opolo 向helios 上运行的名称服务器查询ucbvax.berkeley.edu 的地址记录(nt: qtype等于A). 此查询本身的id号为'3'. 符号<br>'+'意味着递归查询标志被设置(nt: dns服务器可向更高层dns服务器查询本服务器不包含的地址记录). 这个最终通过IP包发送的查询请求<br>数据长度为37字节, 其中不包括UDP和IP协议的头数据. 因为此查询操作为默认值(nt | rt: normal one的理解), op字段被省略.<br>如果op字段没被省略, 会被显示在'3' 和'+'之间. 同样, qclass也是默认值, C_IN, 从而也没被显示, 如果没被忽略, 她会被显示在'A'之后.</p><p style='font-size:13px;'>异常检查会在方括中显示出附加的域:　如果一个查询同时包含一个回应(nt: 可理解为, 对之前其他一个请求的回应), 并且此回应包含权威或附加记录段,　<br>ancount, nscout, arcount(nt: 具体字段含义需补充) 将被显示为'[na]', '[nn]', '[nau]', 其中n代表合适的计数. 如果包中以下<br>回应位(比如AA位, RA位, rcode位), 或者字节2或3中任何一个'必须为0'的位被置位(nt: 设置为1), '[b2&amp;3]=x' 将被显示, 其中x表示<br>头部字节2与字节3进行与操作后的值.</p><p style='font-size:13px;'>UDP 名称服务应答</p><p style='font-size:13px;'>对名称服务应答的数据包，tcpdump会有如下的显示格式<br>src &gt; dst: id op rcode flags a/n/au type class data (len)<br>比如具体显示如下:<br>helios.domain &gt; h2opolo.1538: 3 3/3/7 A 128.32.137.3 (273)<br>helios.domain &gt; h2opolo.1537: 2 NXDomain* 0/1/0 (97)</p><p style='font-size:13px;'>第一行表示: helios 对h2opolo 所发送的3号查询请求回应了3条回答记录(nt | rt: answer records), 3条名称服务器记录,<br>以及7条附加的记录. 第一个回答记录(nt: 3个回答记录中的第一个)类型为A(nt: 表示地址), 其数据为internet地址128.32.137.3.<br>此回应UDP数据包, 包含273字节的数据(不包含UPD和IP的头部数据). op字段和rcode字段被忽略(nt: op的实际值为Query, rcode, 即<br>response code的实际值为NoError), 同样被忽略的字段还有class 字段(nt | rt: 其值为C_IN, 这也是A类型记录默认取值)</p><p style='font-size:13px;'>第二行表示: helios 对h2opolo 所发送的2号查询请求做了回应. 回应中, rcode编码为NXDomain(nt: 表示不存在的域)), 没有回答记录,<br>但包含一个名称服务器记录, 不包含权威服务器记录(nt | ck: 从上文来看, 此处的authority records 就是上文中对应的additional<br>records). '*'表示权威服务器回答标志被设置(nt: 从而additional records就表示的是authority records).<br>由于没有回答记录, type, class, data字段都被忽略.</p><p style='font-size:13px;'>flag字段还有可能出现其他一些字符, 比如'-'(nt: 表示可递归地查询, 即RA 标志没有被设置), '|'(nt: 表示被截断的消息, 即TC 标志<br>被置位). 如果应答(nt | ct: 可理解为, 包含名称服务应答的UDP数据包, tcpdump知道这类数据包该怎样解析其数据)的'question'段一个条<br>目(entry)都不包含(nt: 每个条目的含义, 需补充),'[nq]' 会被打印出来.</p><p style='font-size:13px;'>要注意的是:名称服务器的请求和应答数据量比较大, 而默认的68字节的抓取长度(nt: snaplen, 可理解为tcpdump的一个设置选项)可能不足以抓取<br>数据包的全部内容. 如果你真的需要仔细查看名称服务器的负载, 可以通过tcpdump 的-s 选项来扩大snaplen值.</p><h2 style='font-size:21px;font-weight:bold;'><span style='font-size:14pt;'><strong>SMB/CIFS 解码</strong></span></h2><p style='font-size:13px;'>tcpdump 已可以对SMB/CIFS/NBT相关应用的数据包内容进行解码(nt: 分别为'Server Message Block Common', 'Internet File System'<br>'在TCP/IP上实现的网络协议NETBIOS的简称'. 这几个服务通常使用UDP的137/138以及TCP的139端口). 原来的对IPX和NetBEUI SMB数据包的<br>解码能力依然可以被使用(nt: NetBEUI为NETBIOS的增强版本).</p><p style='font-size:13px;'><br>tcpdump默认只按照最简约模式对相应数据包进行解码, 如果我们想要详尽的解码信息可以使用其-v 启动选现. 要注意的是, -v 会产生非常详细的信息,<br>比如对单一的一个SMB数据包, 将产生一屏幕或更多的信息, 所以此选项, 确有需要才使用.</p><p style='font-size:13px;'>关于SMB数据包格式的信息, 以及每个域的含义可以参看www.cifs.org 或者samba.org 镜像站点的pub/samba/specs/ 目录. linux 上的SMB 补丁<br>(nt | rt: patch)由 Andrew Tridgell (tridge@samba.org)提供.</p><p style='font-size:13px;'><br>NFS 请求和回应</p><p style='font-size:13px;'>tcpdump对Sun NFS(网络文件系统)请求和回应的UDP数据包有如下格式的打印输出:<br>src.xid &gt; dst.nfs: len op args<br>src.nfs &gt; dst.xid: reply stat len op results</p><p style='font-size:13px;'>以下是一组具体的输出数据<br>sushi.6709 &gt; wrl.nfs: 112 readlink fh 21,24/10.73165<br>wrl.nfs &gt; sushi.6709: reply ok 40 readlink '../var'<br>sushi.201b &gt; wrl.nfs:<br>144 lookup fh 9,74/4096.6878 'xcolors'<br>wrl.nfs &gt; sushi.201b:<br>reply ok 128 lookup fh 9,74/4134.3150</p><p style='font-size:13px;'>第一行输出表明: 主机sushi向主机wrl发送了一个'交换请求'(nt: transaction), 此请求的id为6709(注意, 主机名字后是交换<br>请求id号, 而不是源端口号). 此请求数据为112字节, 其中不包括UDP和IP头部的长度. 操作类型为readlink(nt: 即此操作为读符号链接操作),<br>操作参数为fh 21,24/10.73165(nt: 可按实际运行环境, 解析如下, fd 表示描述的为文件句柄, 21,24 表示此句柄所对应设<br>备的主/从设备号对, 10表示此句柄所对应的i节点编号(nt:每个文件都会在操作系统中对应一个i节点, 限于unix类系统中),<br>73165是一个编号(nt: 可理解为标识此请求的一个随机数, 具体含义需补充)).</p><p style='font-size:13px;'>第二行中, wrl 做了'ok'的回应, 并且在results 字段中返回了sushi想要读的符号连接的真实目录(nt: 即sushi要求读的符号连接其实是一个目录).</p><p style='font-size:13px;'>第三行表明: sushi 再次请求 wrl 在'fh 9,74/4096.6878'所描述的目录中查找'xcolors'文件. 需要注意的是, 每行所显示的数据含义依赖于其中op字段的<br>类型(nt: 不同op 所对应args 含义不相同), 其格式遵循NFS 协议, 追求简洁明了.</p><p style='font-size:13px;'>&nbsp;</p><p style='font-size:13px;'>如果tcpdump 的-v选项(详细打印选项) 被设置, 附加的信息将被显示. 比如:<br>sushi.1372a &gt; wrl.nfs:<br>148 read fh 21,11/12.195 8192 bytes @ 24576<br>wrl.nfs &gt; sushi.1372a:<br>reply ok 1472 read REG 100664 ids 417/0 sz 29388</p><p style='font-size:13px;'>(-v 选项一般还会打印出IP头部的TTL, ID， length, 以及fragmentation 域, 但在此例中, 都略过了(nt: 可理解为,简洁起见, 做了删减))<br>在第一行, sushi 请求wrl 从文件 21,11/12.195(nt: 格式在上面有描述)中, 自偏移24576字节处开始, 读取8192字节数据.<br>Wrl 回应读取成功; 由于第二行只是回应请求的开头片段, 所以只包含1472字节(其他的数据将在接着的reply片段中到来, 但这些数据包不会再有NFS<br>头, 甚至UDP头信息也为空(nt: 源和目的应该要有), 这将导致这些片段不能满足过滤条件, 从而没有被打印). -v 选项除了显示文件数据信息, 还会显示<br>附加显示文件属性信息: file type(文件类型, ''REG'' 表示普通文件), file mode(文件存取模式, 8进制表示的), uid 和gid(nt: 文件属主和<br>组属主), file size (文件大小).</p><p style='font-size:13px;'>如果-v 标志被多次重复给出(nt: 如-vv)， tcpdump会显示更加详细的信息.</p><p style='font-size:13px;'>必须要注意的是, NFS 请求包中数据比较多, 如果tcpdump 的snaplen(nt: 抓取长度) 取太短将不能显示其详细信息. 可使用<br>'-s 192'来增加snaplen, 这可用以监测NFS应用的网络负载(nt: traffic).</p><p style='font-size:13px;'>NFS 的回应包并不严格的紧随之前相应的请求包(nt: RPC operation). 从而, tcpdump 会跟踪最近收到的一系列请求包, 再通过其<br>交换序号(nt: transaction ID)与相应请求包相匹配. 这可能产生一个问题， 如果回应包来得太迟, 超出tcpdump 对相应请求包的跟踪范围,<br>该回应包将不能被分析.</p><h2 style='font-size:21px;font-weight:bold;'><br><span style='font-size:14pt;'><strong>AFS 请求和回应</strong></span></h2><p style='font-size:13px;'>AFS(nt: Andrew 文件系统, Transarc , 未知, 需补充)请求和回应有如下的答应</p><p style='font-size:13px;'>src.sport &gt; dst.dport: rx packet-type<br>src.sport &gt; dst.dport: rx packet-type service call call-name args<br>src.sport &gt; dst.dport: rx packet-type service reply call-name args</p><p style='font-size:13px;'>elvis.7001 &gt; pike.afsfs:<br>rx data fs call rename old fid 536876964/1/1 '.newsrc.new'<br>new fid 536876964/1/1 '.newsrc'<br>pike.afsfs &gt; elvis.7001: rx data fs reply rename</p><p style='font-size:13px;'>在第一行, 主机elvis 向pike 发送了一个RX数据包.<br>这是一个对于文件服务的请求数据包(nt: RX data packet, 发送数据包 , 可理解为发送包过去, 从而请求对方的服务), 这也是一个RPC<br>调用的开始(nt: RPC, remote procedure call). 此RPC 请求pike 执行rename(nt: 重命名) 操作, 并指定了相关的参数:<br>原目录描述符为536876964/1/1, 原文件名为 '.newsrc.new', 新目录描述符为536876964/1/1, 新文件名为 '.newsrc'.<br>主机pike 对此rename操作的RPC请求作了回应(回应表示rename操作成功, 因为回应的是包含数据内容的包而不是异常包).</p><p style='font-size:13px;'>一般来说, 所有的'AFS RPC'请求被显示时, 会被冠以一个名字(nt: 即decode, 解码), 这个名字往往就是RPC请求的操作名.<br>并且, 这些RPC请求的部分参数在显示时, 也会被冠以一个名字(nt | rt: 即decode, 解码, 一般来说也是取名也很直接, 比如,<br>一个interesting 参数, 显示的时候就会直接是'interesting', 含义拗口, 需再翻).</p><p style='font-size:13px;'>这种显示格式的设计初衷为'一看就懂', 但对于不熟悉AFS 和 RX 工作原理的人可能不是很<br>有用(nt: 还是不用管, 书面吓吓你的, 往下看就行).</p><p style='font-size:13px;'>如果 -v(详细)标志被重复给出(nt: 如-vv), tcpdump 会打印出确认包(nt: 可理解为, 与应答包有区别的包)以及附加头部信息<br>(nt: 可理解为, 所有包, 而不仅仅是确认包的附加头部信息), 比如, RX call ID(请求包中'请求调用'的ID),<br>call number('请求调用'的编号), sequence number(nt: 包顺序号),<br>serial number(nt | rt: 可理解为与包中数据相关的另一个顺信号, 具体含义需补充), 请求包的标识. (nt: 接下来一段为重复描述,<br>所以略去了), 此外确认包中的MTU协商信息也会被打印出来(nt: 确认包为相对于请求包的确认包, Maximum Transmission Unit, 最大传输单元).</p><p style='font-size:13px;'>如果 -v 选项被重复了三次(nt: 如-vvv), 那么AFS应用类型数据包的'安全索引'('security index')以及'服务索引'('service id')将会<br>被打印.</p><p style='font-size:13px;'>对于表示异常的数据包(nt: abort packet, 可理解为, 此包就是用来通知接受者某种异常已发生), tcpdump 会打印出错误号(error codes).<br>但对于Ubik beacon packets(nt: Ubik 灯塔指示包, Ubik可理解为特殊的通信协议, beacon packets, 灯塔数据包, 可理解为指明通信中<br>关键信息的一些数据包), 错误号不会被打印, 因为对于Ubik 协议, 异常数据包不是表示错误, 相反却是表示一种肯定应答(nt: 即, yes vote).</p><p style='font-size:13px;'>AFS 请求数据量大, 参数也多, 所以要求tcpdump的 snaplen 比较大, 一般可通过启动tcpdump时设置选项'-s 256' 来增大snaplen, 以<br>监测AFS 应用通信负载.</p><p style='font-size:13px;'>AFS 回应包并不显示标识RPC 属于何种远程调用. 从而, tcpdump 会跟踪最近一段时间内的请求包, 并通过call number(调用编号), service ID<br>(服务索引) 来匹配收到的回应包. 如果回应包不是针对最近一段时间内的请求包, tcpdump将无法解析该包.</p><h2 style='font-size:21px;font-weight:bold;'><br><span style='font-size:14pt;'><strong>KIP AppleTalk协议</strong></span></h2><p style='font-size:13px;'>(nt | rt: DDP in UDP可理解为, DDP, The AppleTalk Data Delivery Protocol,<br>相当于支持KIP AppleTalk协议栈的网络层协议, 而DDP 本身又是通过UDP来传输的,<br>即在UDP 上实现的用于其他网络的网络层，KIP AppleTalk是苹果公司开发的整套网络协议栈).</p><p style='font-size:13px;'>AppleTalk DDP 数据包被封装在UDP数据包中, 其解封装(nt: 相当于解码)和相应信息的转储也遵循DDP 包规则.<br>(nt:encapsulate, 封装, 相当于编码, de-encapsulate, 解封装, 相当于解码, dump, 转储, 通常就是指对其信息进行打印).</p><p style='font-size:13px;'>/etc/atalk.names 文件中包含了AppleTalk 网络和节点的数字标识到名称的对应关系. 其文件格式通常如下所示:<br>number name</p><p style='font-size:13px;'>1.254 ether<br>16.1 icsd-net<br>1.254.110 ace</p><p style='font-size:13px;'>头两行表示有两个AppleTalk 网络. 第三行给出了特定网络上的主机(一个主机会用3个字节来标识,<br>而一个网络的标识通常只有两个字节, 这也是两者标识的主要区别)(nt: 1.254.110 可理解为ether网络上的ace主机).<br>标识与其对应的名字之间必须要用空白分开. 除了以上内容, /etc/atalk.names中还包含空行以及注释行(以'#'开始的行).</p><p style='font-size:13px;'><br>AppleTalk 完整网络地址将以如下格式显示:<br>net.host.port</p><p style='font-size:13px;'>以下为一段具体显示:<br>144.1.209.2 &gt; icsd-net.112.220<br>office.2 &gt; icsd-net.112.220<br>jssmag.149.235 &gt; icsd-net.2</p><p style='font-size:13px;'>(如果/etc/atalk.names 文件不存在, 或者没有相应AppleTalk 主机/网络的条目, 数据包的网络地址将以数字形式显示).</p><p style='font-size:13px;'>在第一行中, 网络144.1上的节点209通过2端口,向网络icsd-net上监听在220端口的112节点发送了一个NBP应用数据包<br>(nt | rt: NBP, name binding protocol, 名称绑定协议, 从数据来看, NBP服务器会在端口2提供此服务.<br>'DDP port 2' 可理解为'DDP 对应传输层的端口2', DDP本身没有端口的概念, 这点未确定, 需补充).</p><p style='font-size:13px;'>第二行与第一行类似, 只是源的全部地址可用'office'进行标识.<br>第三行表示: jssmag网络上的149节点通过235向icsd-net网络上的所有节点的2端口(NBP端口)发送了数据包.(需要注意的是,<br>在AppleTalk 网络中如果地址中没有节点, 则表示广播地址, 从而节点标识和网络标识最好在/etc/atalk.names有所区别.<br>nt: 否则一个标识x.port 无法确定x是指一个网络上所有主机的port口还是指定主机x的port口).</p><p style='font-size:13px;'>tcpdump 可解析NBP (名称绑定协议) and ATP (AppleTalk传输协议)数据包, 对于其他应用层的协议, 只会打印出相应协议名字(<br>如果此协议没有注册一个通用名字, 只会打印其协议号)以及数据包的大小.</p><p style='font-size:13px;'><br>NBP 数据包会按照如下格式显示:<br>icsd-net.112.220 &gt; jssmag.2: nbp-lkup 190: '=:LaserWriter@*'<br>jssmag.209.2 &gt; icsd-net.112.220: nbp-reply 190: 'RM1140:LaserWriter@*' 250<br>techpit.2 &gt; icsd-net.112.220: nbp-reply 190: 'techpit:LaserWriter@*' 186</p><p style='font-size:13px;'>第一行表示: 网络icsd-net 中的节点112 通过220端口向网络jssmag 中所有节点的端口2发送了对'LaserWriter'的名称查询请求(nt:<br>此处名称可理解为一个资源的名称, 比如打印机). 此查询请求的序列号为190.</p><p style='font-size:13px;'>第二行表示: 网络jssmag 中的节点209 通过2端口向icsd-net.112节点的端口220进行了回应: 我有'LaserWriter'资源, 其资源名称<br>为'RM1140', 并且在端口250上提供改资源的服务. 此回应的序列号为190, 对应之前查询的序列号.</p><p style='font-size:13px;'>第三行也是对第一行请求的回应: 节点techpit 通过2端口向icsd-net.112节点的端口220进行了回应:我有'LaserWriter'资源, 其资源名称<br>为'techpit', 并且在端口186上提供改资源的服务. 此回应的序列号为190, 对应之前查询的序列号.</p><p style='font-size:13px;'><br>ATP 数据包的显示格式如下:<br>jssmag.209.165 &gt; helios.132: atp-req 12266&lt;0-7&gt; 0xae030001<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:0 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:1 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:2 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:3 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:5 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:6 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp*12266:7 (512) 0xae040000<br>jssmag.209.165 &gt; helios.132: atp-req 12266&lt;3,5&gt; 0xae030001<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:3 (512) 0xae040000<br>helios.132 &gt; jssmag.209.165: atp-resp 12266:5 (512) 0xae040000<br>jssmag.209.165 &gt; helios.132: atp-rel 12266&lt;0-7&gt; 0xae030001<br>jssmag.209.133 &gt; helios.132: atp-req* 12267&lt;0-7&gt; 0xae030002</p><p style='font-size:13px;'>第一行表示节点 Jssmag.209 向节点helios 发送了一个会话编号为12266的请求包, 请求helios<br>回应8个数据包(这8个数据包的顺序号为0-7(nt: 顺序号与会话编号不同, 后者为一次完整传输的编号,<br>前者为该传输中每个数据包的编号. transaction, 会话, 通常也被叫做传输)). 行尾的16进制数字表示<br>该请求包中'userdata'域的值(nt: 从下文来看, 这并没有把所有用户数据都打印出来 ).</p><p style='font-size:13px;'>Helios 回应了8个512字节的数据包. 跟在会话编号(nt: 12266)后的数字表示该数据包在该会话中的顺序号.<br>括号中的数字表示该数据包中数据的大小, 这不包括atp 的头部. 在顺序号为7数据包(第8行)外带了一个'*'号,<br>表示该数据包的EOM 标志被设置了.(nt: EOM, End Of Media, 可理解为, 表示一次会话的数据回应完毕).</p><p style='font-size:13px;'>接下来的第9行表示, Jssmag.209 又向helios 提出了请求: 顺序号为3以及5的数据包请重新传送. Helios 收到这个<br>请求后重新发送了这个两个数据包, jssmag.209 再次收到这两个数据包之后, 主动结束(release)了此会话.</p><p style='font-size:13px;'>在最后一行, jssmag.209 向helios 发送了开始下一次会话的请求包. 请求包中的'*'表示该包的XO 标志没有被设置.<br>(nt: XO, exactly once, 可理解为在该会话中, 数据包在接受方只被精确地处理一次, 就算对方重复传送了该数据包,<br>接收方也只会处理一次, 这需要用到特别设计的数据包接收和处理机制).</p><h2 style='font-size:21px;font-weight:bold;'><br><span style='font-size:14pt;'><strong>IP 数据包破碎</strong></span></h2><p style='font-size:13px;'>(nt: 指把一个IP数据包分成多个IP数据包)</p><p style='font-size:13px;'>碎片IP数据包(nt: 即一个大的IP数据包破碎后生成的小IP数据包)有如下两种显示格式.<br>(frag id:size@offset+)<br>(frag id:size@offset)<br>(第一种格式表示, 此碎片之后还有后续碎片. 第二种格式表示, 此碎片为最后一个碎片.)</p><p style='font-size:13px;'>id 表示破碎编号(nt: 从下文来看, 会为每个要破碎的大IP包分配一个破碎编号, 以便区分每个小碎片是否由同一数据包破碎而来).<br>size 表示此碎片的大小 , 不包含碎片头部数据. offset表示此碎片所含数据在原始整个IP包中的偏移((nt: 从下文来看,<br>一个IP数据包是作为一个整体被破碎的, 包括头和数据, 而不只是数据被分割).</p><p style='font-size:13px;'>每个碎片都会使tcpdump产生相应的输出打印. 第一个碎片包含了高层协议的头数据(nt:从下文来看, 被破碎IP数据包中相应tcp头以及<br>IP头都放在了第一个碎片中 ), 从而tcpdump会针对第一个碎片显示这些信息, 并接着显示此碎片本身的信息. 其后的一些碎片并不包含<br>高层协议头信息, 从而只会在显示源和目的之后显示碎片本身的信息. 以下有一个例子: 这是一个从arizona.edu 到lbl-rtsg.arpa<br>途经CSNET网络(nt: CSNET connection 可理解为建立在CSNET 网络上的连接)的ftp应用通信片段:<br>arizona.ftp-data &gt; rtsg.1170: . 1024:1332(308) ack 1 win 4096 (frag 595a:328@0+)<br>arizona &gt; rtsg: (frag 595a:204@328)<br>rtsg.1170 &gt; arizona.ftp-data: . ack 1536 win 2560</p><p style='font-size:13px;'>有几点值得注意:<br>第一, 第二行的打印中, 地址后面没有端口号.<br>这是因为TCP协议信息都放到了第一个碎片中, 当显示第二个碎片时, 我们无法知道此碎片所对应TCP包的顺序号.</p><p style='font-size:13px;'>第二, 从第一行的信息中, 可以发现arizona需要向rtsg发送308字节的用户数据, 而事实是, 相应IP包经破碎后会总共产生512字节<br>数据(第一个碎片包含308字节的数据, 第二个碎片包含204个字节的数据, 这超过了308字节). 如果你在查找数据包的顺序号空间中的<br>一些空洞(nt: hole,空洞, 指数据包之间的顺序号没有上下衔接上), 512这个数据就足够使你迷茫一阵(nt: 其实只要关注308就行,<br>不必关注破碎后的数据总量).</p><p style='font-size:13px;'>一个数据包(nt | rt: 指IP数据包)如果带有非IP破碎标志, 则显示时会在最后显示'(DF)'.(nt: 意味着此IP包没有被破碎过).</p><h2 style='font-size:21px;font-weight:bold;'><br><span style='font-size:14pt;'><strong>时间戳</strong></span></h2><p style='font-size:13px;'>tcpdump的所有输出打印行中都会默认包含时间戳信息.<br>时间戳信息的显示格式如下<br>hh:mm:ss.frac　(nt: 小时:分钟:秒.(nt: frac未知, 需补充))<br>此时间戳的精度与内核时间精度一致,　反映的是内核第一次看到对应数据包的时间(nt: saw, 即可对该数据包进行操作).　<br>而数据包从物理线路传递到内核的时间, 以及内核花费在此包上的中断处理时间都没有算进来.</p><p style='font-size:13px;'>&nbsp;</p><h1 style='font-size:28px;font-weight:bold;'><strong><span style='font-size:18pt;'>命令使用</span></strong></h1><p style='font-size:13px;'>tcpdump采用命令行方式，它的命令格式为：</p> 
   <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
    <div style='background-color:rgb(245, 245, 245);'> 
     <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2423/AACFEEDFEC60413388AB02F5582E7FD1' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
    </div> 
    <pre style='font-family:'Courier New' !important;font-size:12px !important;'>tcpdump [ -AdDeflLnNOpqRStuUvxX ] [ -c count ]<br>           [ -C file_size ] [ -F file ]<br>           [ -i <span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>interface</span> ] [ -m module ] [ -M secret ]<br>           [ -r file ] [ -s snaplen ] [ -T type ] [ -w file ]<br>           [ -W filecount ]<br>           [ -E spi@ipaddr algo:secret,...  ]<br>           [ -y datalinktype ] [ -Z user ]<br>           [ expression ]</pre> 
    <div style='background-color:rgb(245, 245, 245);'> 
     <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2423/AACFEEDFEC60413388AB02F5582E7FD1' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
    </div> 
   </div></a> 
  <h2 style='font-size:21px;font-weight:bold;'><strong><span style='font-size:14pt;'>tcpdump的简单选项介绍</span></strong></h2> 
  <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'> 
   <div style='background-color:rgb(245, 245, 245);'> 
    <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2423/AACFEEDFEC60413388AB02F5582E7FD1' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
   </div> 
   <pre style='font-family:'Courier New' !important;font-size:12px !important;'>-A  以ASCII码方式显示每一个数据包(不会显示数据包中链路层头部信息). 在抓取包含网页数据的数据包时, 可方便查看数据(nt: 即Handy <span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>for</span> capturing web pages).<br><br>-c  count<br>    tcpdump将在接受到count个数据包后退出.<br><br>-C  file-size (nt: 此选项用于配合-w file 选项使用)<br>    该选项使得tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过file-size. 如果超过了, 将关闭此文件,另创一个文件继续用于原始数据包的记录. 新创建的文件名与-w 选项指定的文件名一致, 但文件名后多了一个数字.该数字会从1开始随着新创建文件的增多而增加. file-size的单位是百万字节(nt: 这里指1,<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>000</span>,000个字节,并非1,<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>048</span>,576个字节, 后者是以1024字节为1k, 1024k字节为1M计算所得, 即1M=<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1024</span> ＊ <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1024</span> ＝ <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span>,<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>048</span>,<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>576</span>)<br><br>-d  以容易阅读的形式,在标准输出上打印出编排过的包匹配码, 随后tcpdump停止.(nt | rt: human readable, 容易阅读的,通常是指以ascii码来打印一些信息. compiled, 编排过的. packet-matching code, 包匹配码,含义未知, 需补充)<br><br>-dd 以C语言的形式打印出包匹配码.<br><br>-ddd 以十进制数的形式打印出包匹配码(会在包匹配码之前有一个附加的<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>count</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>前缀).<br><br>-D  打印系统中所有tcpdump可以在其上进行抓包的网络接口. 每一个接口会打印出数字编号, 相应的接口名字, 以及可能的一个网络接口描述. 其中网络接口名字和数字编号可以用在tcpdump 的-i flag 选项(nt: 把名字或数字代替flag), 来指定要在其上抓包的网络接口.<br><br>    此选项在不支持接口列表命令的系统上很有用(nt: 比如, Windows 系统, 或缺乏 ifconfig -a 的UNIX系统); 接口的数字编号在windows <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2000</span> 或其后的系统中很有用, 因为这些系统上的接口名字比较复杂, 而不易使用.<br><br>    如果tcpdump编译时所依赖的libpcap库太老,-D 选项不会被支持, 因为其中缺乏 pcap_findalldevs()函数.<br><br>-e  每行的打印输出中将包括数据包的数据链路层头部信息<br><br>-E  spi@ipaddr algo:secret,...<br><br>    可通过spi@ipaddr algo:secret 来解密IPsec ESP包(nt | rt:IPsec Encapsulating Security Payload,IPsec 封装安全负载, IPsec可理解为, 一整套对ip数据包的加密协议, ESP 为整个IP 数据包或其中上层协议部分被加密后的数据,前者的工作模式称为隧道模式; 后者的工作模式称为传输模式 . 工作原理, 另需补充).<br><br>    需要注意的是, 在终端启动tcpdump 时, 可以为IPv4 ESP packets 设置密钥(secret）.<br><br>    可用于加密的算法包括des-cbc, 3des-cbc, blowfish-cbc, rc3-cbc, cast128-cbc, 或者没有(none).默认的是des-cbc(nt: des, Data Encryption Standard, 数据加密标准, 加密算法未知, 另需补充).secret 为用于ESP 的密钥, 使用ASCII 字符串方式表达. 如果以 0x 开头, 该密钥将以16进制方式读入.<br><br>    该选项中ESP 的定义遵循RFC2406, 而不是 RFC1827. 并且, 此选项只是用来调试的, 不推荐以真实密钥(secret)来使用该选项, 因为这样不安全: 在命令行中输入的secret 	<p class="tag"></p>
	<div style="display:none;">et_highlighter51</div>	<div class="nextlog">		&laquo; <a href="http://onelose.com/post-281.html">【问底】王帅：深入PHP内核（二）——SAPI探究</a>
				|
				 <a href="http://onelose.com/post-298.html">UPDATE `ts_user_job`SET`area_str`=CONCAT(SUBSTRING</a>&raquo;
	</div>
				    <div id="pagenavi">
	        </div>
		<div id="comment-place">
	<div class="comment-post" id="comment-post">
		<div class="cancel-reply" id="cancel-reply" style="display:none"><a href="javascript:void(0);" onclick="cancelReply()">取消回复</a></div>
		<p class="comment-header"><b>发表评论：</b><a name="respond"></a></p>
		<form method="post" name="commentform" action="http://onelose.com/index.php?action=addcom" id="commentform">
			<input type="hidden" name="gid" value="290" />
						<p>
				<input type="text" name="comname" maxlength="49" value="" size="22" tabindex="1">
				<label for="author"><small>昵称</small></label>
			</p>
			<p>
				<input type="text" name="commail"  maxlength="128"  value="" size="22" tabindex="2">
				<label for="email"><small>邮件地址 (选填)</small></label>
			</p>
			<p>
				<input type="text" name="comurl" maxlength="128"  value="" size="22" tabindex="3">
				<label for="url"><small>个人主页 (选填)</small></label>
			</p>
						<p><textarea name="comment" id="comment" rows="10" tabindex="4"></textarea></p>
			<p> <input type="submit" id="comment_submit" value="发表评论" tabindex="6" /></p>
			<input type="hidden" name="pid" id="comment-pid" value="0" size="22" tabindex="1"/>
		</form>
	</div>
	</div>
		<div style="clear:both;"></div>
</div><!--end #contentleft-->
<ul id="sidebar">
	<li>
	<h3><span>搜索</span></h3>
	<ul id="logsearch">
	<form name="keyform" method="get" action="http://onelose.com/index.php">
	<input name="keyword" class="search" type="text" />
	</form>
	</ul>
	</li>
	<li>
	<h3><span>最新微语</span></h3>
	<ul id="twitter">
			<li>诺基亚ceo可以对比尔盖茨说，主公，幸不辱命<p>2013-09-03 16:22</p></li>
			<li>换空间了<p>2013-09-02 23:28</p></li>
			<li>玩上古剑奇谭2了，画质非常好<p>2013-08-20 14:08</p></li>
			<li>最打算更新这个模板，估计会用上php<p>2013-08-16 23:10</p></li>
			<li>模板在emlog官网已经下载超过100次~\(≧▽≦)/~啦啦啦<p>2013-08-02 21:33</p></li>
	    	<p><a href="http://onelose.com/t/">更多&raquo;</a></p>
		</ul>
	</li>
	<li>
	<h3><span>随机文章</span></h3>
	<ul id="randlog">
		<li><a href="http://onelose.com/post-194.html">深入解析php之sphinx</a></li>
		<li><a href="http://onelose.com/post-397.html">Memcache及telnent命令详解</a></li>
		<li><a href="http://onelose.com/post-257.html">PHP扩展编写点滴技巧收集</a></li>
		<li><a href="http://onelose.com/post-418.html">HTML5中使用js控制audio标签的方法</a></li>
		<li><a href="http://onelose.com/post-446.html">gitkey</a></li>
		</ul>
	</li>
	<li>
	<h3><span>最新文章</span></h3>
	<ul id="newlog">
		<li><a href="http://onelose.com/post-204.html">Redis数据库安全手册</a></li>
		<li><a href="http://onelose.com/post-200.html">MongoDB服务器端的JavaScript注入</a></li>
		<li><a href="http://onelose.com/post-202.html">http://www.freebuf.com/author/unshell</a></li>
		<li><a href="http://onelose.com/post-211.html">mysql性能优化方向</a></li>
		<li><a href="http://onelose.com/post-209.html">开源消息队列MemcacheQ在Linux中编译安装教程</a></li>
		</ul>
	</li>
	<li>
	<h3><span>最新评论</span></h3>
	<ul id="newcomment">
		<li id="comment">你大爷	<br /><a href="http://onelose.com/post-216.html#5096">我搞定了哈哈,不告诉你我是谁</a></li>
		<li id="comment">网络精灵	<br /><a href="http://onelose.com/post-113.html#4948">我想问改一下你的魔板的问题，能加下我QQ...</a></li>
		<li id="comment">9格购	<br /><a href="http://onelose.com/post-169.html#4698">很不错的模板</a></li>
		<li id="comment">陈正杰博客	<br /><a href="http://onelose.com/post-113.html#4649">好像很就没有更新内容了哟</a></li>
		<li id="comment">迷茫者	<br /><a href="http://onelose.com/post-113.html#4647">@彼岸时光网：O(∩_∩)O~&nbsp;&nbsp; 欢迎...</a></li>
		</ul>
	</li>
	<li>
	<h3><span>分类</span></h3>
	<ul id="blogsort">
		<li>
	<a href="http://onelose.com/sort/youdao">有道云笔记(305)</a>
	<a href="http://onelose.com/rss.php?sort=19"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/notes">学习笔记(8)</a>
	<a href="http://onelose.com/rss.php?sort=18"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/4">生活(1)</a>
	<a href="http://onelose.com/rss.php?sort=4"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/5">网站(7)</a>
	<a href="http://onelose.com/rss.php?sort=5"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/6">服务器(1)</a>
	<a href="http://onelose.com/rss.php?sort=6"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/7">动画片(1)</a>
	<a href="http://onelose.com/rss.php?sort=7"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/16">作业(1)</a>
	<a href="http://onelose.com/rss.php?sort=16"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/17">大学(1)</a>
	<a href="http://onelose.com/rss.php?sort=17"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			</ul>
	</li>
	<li>
	<h3><span>存档</span></h3>
	<ul id="record">
		<li><a href="http://onelose.com/record/201504">2015年4月(23)</a></li>
		<li><a href="http://onelose.com/record/201503">2015年3月(69)</a></li>
		<li><a href="http://onelose.com/record/201502">2015年2月(9)</a></li>
		<li><a href="http://onelose.com/record/201501">2015年1月(57)</a></li>
		<li><a href="http://onelose.com/record/201412">2014年12月(46)</a></li>
		<li><a href="http://onelose.com/record/201411">2014年11月(16)</a></li>
		<li><a href="http://onelose.com/record/201410">2014年10月(18)</a></li>
		<li><a href="http://onelose.com/record/201409">2014年9月(9)</a></li>
		<li><a href="http://onelose.com/record/201408">2014年8月(10)</a></li>
		<li><a href="http://onelose.com/record/201407">2014年7月(17)</a></li>
		<li><a href="http://onelose.com/record/201406">2014年6月(5)</a></li>
		<li><a href="http://onelose.com/record/201405">2014年5月(7)</a></li>
		<li><a href="http://onelose.com/record/201404">2014年4月(21)</a></li>
		<li><a href="http://onelose.com/record/201402">2014年2月(7)</a></li>
		<li><a href="http://onelose.com/record/201401">2014年1月(2)</a></li>
		<li><a href="http://onelose.com/record/201309">2013年9月(3)</a></li>
		<li><a href="http://onelose.com/record/201308">2013年8月(5)</a></li>
		<li><a href="http://onelose.com/record/201307">2013年7月(4)</a></li>
		<li><a href="http://onelose.com/record/201105">2011年5月(2)</a></li>
		<li><a href="http://onelose.com/record/201104">2011年4月(3)</a></li>
		<li><a href="http://onelose.com/record/201103">2011年3月(8)</a></li>
		<li><a href="http://onelose.com/record/201102">2011年2月(4)</a></li>
		<li><a href="http://onelose.com/record/201101">2011年1月(7)</a></li>
		<li><a href="http://onelose.com/record/201012">2010年12月(18)</a></li>
		<li><a href="http://onelose.com/record/201011">2010年11月(4)</a></li>
		<li><a href="http://onelose.com/record/201010">2010年10月(18)</a></li>
		<li><a href="http://onelose.com/record/201009">2010年9月(1)</a></li>
		<li><a href="http://onelose.com/record/201008">2010年8月(1)</a></li>
		<li><a href="http://onelose.com/record/201003">2010年3月(1)</a></li>
		</ul>
	</li>
	<li>
	<h3><span>链接</span></h3>
	<ul id="link">
		<li><a href="http://www.swoole.com/" title="Swoole：重新定义PHP" target="_blank">Swoole</a></li>
		<li><a href="http://rango.swoole.com/" title="" target="_blank">韩天峰(Rango)</a></li>
		<li><a href="http://www.laruence.com/" title="" target="_blank">风雪之隅</a></li>
		<li><a href="http://blog.csdn.net/ldy3243942" title="" target="_blank">ldy3243942的专栏</a></li>
		<li><a href="http://programmer.csdn.net/" title="" target="_blank">程序员</a></li>
		<li><a href="http://www.mysqlsupport.cn/" title="" target="_blank">mysqlsupport</a></li>
		<li><a href="http://www.ttlsa.com/" title="" target="_blank">运维生存时间</a></li>
		<li><a href="http://imysql.com/" title="" target="_blank">MySQL中文网</a></li>
		<li><a href="http://jinnianshilongnian.iteye.com/" title="" target="_blank">开涛的博客</a></li>
		<li><a href="http://www.imsiren.com/" title="Where Amaze happen，Where I Am !" target="_blank">斯人-吴帅</a></li>
		<li><a href="http://blog.41ms.com/" title="" target="_blank">松鼠先生</a></li>
		</ul>
	</li>
	<li>
	<h3><span>日历</span></h3>
	<div id="calendar">
	</div>
	<script>sendinfo('http://onelose.com:80/?action=cal','calendar');</script>
	</li>
	<li>
	<h3><span>蝴蝶</span></h3>
	<ul>
	<CENTER><EMBED style="RIGHT: 10px; POSITION: absolute; TOP: -40px" align=right src=http://onelose.com/butterfly.swf width=160 height=200 type=application/x-shockwave-flash wmode="transparent" quality="high" ;></CENTER>	</ul>
	</li>
	<li>
	<h3><span>水滴</span></h3>
	<ul>
	<CENTER><EMBED style="LEFT: 10px; POSITION: absolute; TOP: -30px" align=right src=http://onelose.com/1.swf width=700 height=160 type=application/x-shockwave-flash wmode="transparent" quality="high" ;></CENTER>	</ul>
	</li>
	<li>
	<h3><span>标签</span></h3>
	<ul id="blogtags">
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/php" title="1 篇文章">php</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/asp" title="1 篇文章">asp</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/c" title="1 篇文章">c</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/c%2B%2B" title="1 篇文章">c++</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/access" title="1 篇文章">access</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/pr" title="1 篇文章">pr</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/mssql2000" title="1 篇文章">mssql2000</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/msql2005" title="1 篇文章">msql2005</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/asp.net" title="1 篇文章">asp.net</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/javascript" title="1 篇文章">javascript</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/emlog" title="1 篇文章">emlog</a></span>
			<span style="font-size:22pt; line-height:30px;">
		<a href="http://onelose.com/tag/mysql" title="2 篇文章">mysql</a></span>
		</ul>
	</li>
<div class="rss">
<a href="http://onelose.com/rss.php" title="RSS订阅"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.gif" alt="订阅Rss"/></a>
</div>
</ul><!--end #siderbar-->
</div><!--end #content-->
<div style="clear:both;"></div>
<div id="footerbar">
	Design By blogbus | Theme By <a href="http://onelose.com" title="迷茫者博客">迷茫者</a> | Powered by <a href="http://www.emlog.net" title="emlog 5.1.2">emlog</a> |  
	<a href="http://www.miibeian.gov.cn" target="_blank">苏ICP备10020146号-1</a> | <!-- Piwik -->
<script type="text/javascript"> 
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.onelose.com//";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();

</script>
<noscript><p><img src="http://piwik.onelose.com/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Code -->
	<script type="text/javascript">XMLHttp.sendReq('GET','http://onelose.com/content/plugins/kl_auto_backup_and_mail/kl_auto_backup_and_mail_do.php','',function(obj){return;});</script>
<script type="text/javascript">$(function(){$.get("http://onelose.com/?plugin=autopub");})</script>
<script type="text/javascript" src="http://onelose.com/content/plugins/SHJS_for_Emlog/sh_main.min.js"></script><a href="http://onelose.com/sitemap.xml" rel="sitemap">sitemap</a></div><!--end #footerbar-->
</div><!--end #wrap-->
<script>prettyPrint();</script>

<div id="returnhome"><a href="#"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/home.png" title="返回" alt="header" id="returnhome_img"></a></div>

</body>
</html>