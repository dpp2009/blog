<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>strace</title>
<meta name="keywords" content="迷茫,dpp,丁盼盼,迷茫者" />
<meta name="description" content="" />
<meta name="generator" content="emlog" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://onelose.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://onelose.com/wlwmanifest.xml" />
<link rel="alternate" type="application/rss+xml" title="RSS"  href="http://onelose.com/rss.php" />
<link href="http://onelose.com/content/templates/dpp_icecream_02/main.css" rel="stylesheet" type="text/css" />
<link href="http://onelose.com/admin/editor/plugins/code/prettify.css" rel="stylesheet" type="text/css" />
<script src="http://onelose.com/admin/editor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="http://onelose.com/include/lib/js/common_tpl.js" type="text/javascript"></script>
<script src="http://onelose.com/content/templates/dpp_icecream_02/js/nav.js" type="text/javascript"></script>
<script src="http://onelose.com/content/templates/dpp_icecream_02/js/jquery-1.10.2.min.js"></script>
<script id="allmobilize" charset="utf-8" src="http://a.yunshipei.com/cbca8680e2150f433cb28b942e85ec26/allmobilize.min.js"></script><meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />
<script src="http://onelose.com/include/lib/js/jquery/jquery-1.7.1.js" type="text/javascript"></script><link rel="stylesheet" type="text/css" href ="http://onelose.com/content/plugins/SHJS_for_Emlog/sh_style.min.css" />
	<script type="text/javascript" src="http://onelose.com/content/plugins/et_highlighter51/scripts/brush.js"></script>
	<link type="text/css" rel="stylesheet" href="http://onelose.com/content/plugins/et_highlighter51/styles/shCore.css"/>
	<link type="text/css" rel="stylesheet" href="http://onelose.com/content/plugins/et_highlighter51/styles/shThemeDefault.css"/>
	<script type="text/javascript">SyntaxHighlighter.config.clipboardSwf = 'http://onelose.com/content/plugins/et_highlighter51/scripts/clipboard.swf';SyntaxHighlighter.all();</script>
	</head>
<body>

<div id="wrap">
<div id="hm">
	<div id="header">
	<div><a href="http://onelose.com/"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/logo.jpg" alt="迷茫者 " title="迷茫者"></a></div>
	<h3>迷茫者王者归来。</h3>
	</div>
	<!-- <div id="banner"><a href="http://onelose.com/"><img src="http://onelose.com/content/templates/default/images/top/terrace.jpg" height="134" width="960" /></a></div> -->
	<div id="nav" >	<ul>
			<li class="common"><a href="http://onelose.com/" >首页</a></li>
			<li class="common"><a href="http://onelose.com/t" >微语</a></li>
			<li class="common"><a href="http://onelose.com/post-113.html" >留言</a></li>
			<li class="common"><a href="http://onelose.com/admin" >登录</a></li>
		</ul>
</div>
</div>
<div id="content">
<div id="contentleft">
	<h2>strace</h2>
	<p class="date">作者：<a href="http://onelose.com/author/1" title="及尽繁华 不过一掬细沙 只望淡泊名利 自在一生 奈何凡尘俗世之杂碎琐事 竟有我舍之不去的牵挂 故 始终俗人！ 1064490567@qq.com">迷茫者</a> 发布于：2015-3-9 7:00 Monday 
			分类：<a href="http://onelose.com/sort/youdao">有道云笔记</a>
	 	</p>
	
 <div> 
 <h1 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:28px;font-style:normal;font-weight:bold;text-align:start;'><strong><span style='font-size:18pt;'>简介</span></strong></h1> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>strace常用来跟踪进程执行时的系统调用和所接收的信号。 在Linux世界，进程不能直接访问硬件设备，当进程需要访问硬件设备(比如读取磁盘文件，接收网络数据等等)时，必须由用户态模式切换至内核态模式，通 过系统调用访问硬件设备。strace可以跟踪到一个进程产生的系统调用,包括参数，返回值，执行消耗的时间。</p> 
 <h1 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:28px;font-style:normal;font-weight:bold;text-align:start;'><strong><span style='font-size:18pt;'>输出参数含义</span></strong></h1> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>root@ubuntu:/usr# strace cat /dev/<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>null</span> <br>execve(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/bin/cat</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, [<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>cat</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/dev/null</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>], [<span style='color:rgb(0, 128, 0);font-family:'Courier New' !important;font-size:12px !important;'>/*</span><span style='color:rgb(0, 128, 0);font-family:'Courier New' !important;font-size:12px !important;'> 22 vars </span><span style='color:rgb(0, 128, 0);font-family:'Courier New' !important;font-size:12px !important;'>*/</span>]) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>brk(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>)                                  = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xab1000</span><br>access(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/etc/ld.so.nohwcap</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, F_OK)      = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>mmap(NULL, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>8192</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0x7f29379a7000</span><br>access(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/etc/ld.so.preload</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, R_OK)      = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>...<br>brk(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xab1000</span><br>brk(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xad2000</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xad2000</span><br>fstat(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span>, {st_mode=S_IFCHR|<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0620</span>, st_rdev=makedev(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>136</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>), ...}) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/dev/null</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span><br>fstat(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>, {st_mode=S_IFCHR|<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0666</span>, st_rdev=makedev(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>), ...}) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>read(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>''</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>32768</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>close(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>close(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>close(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>exit_group(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>) = ?</pre> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>每一行都是一条系统调用，等号左边是系统调用的函数名及其参数，右边是该调用的返回值。<br>strace 显示这些调用的参数并返回符号形式的值。strace 从内核接收信息，而且不需要以任何特殊的方式来构建内核。</p> 
 <h1 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:28px;font-style:normal;font-weight:bold;text-align:start;'><span style='font-size:18pt;'><strong>strace参数</strong></span></h1> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>-c 统计每一系统调用的所执行的时间,次数和出错的次数等. <br>-d 输出strace关于标准错误的调试信息. <br>-f 跟踪由fork调用所产生的子进程. <br>-ff 如果提供-o filename,则所有进程的跟踪结果输出到相应的filename.pid中,pid是各进程的进程号. <br>-F 尝试跟踪vfork调用.在-f时,vfork不被跟踪. <br>-h 输出简要的帮助信息. <br>-i 输出系统调用的入口指针. <br>-q 禁止输出关于脱离的消息. <br>-r 打印出相对时间关于,,每一个系统调用. <br>-t 在输出中的每一行前加上时间信息. <br>-tt 在输出中的每一行前加上时间信息,微秒级. <br>-ttt 微秒级输出,以秒了表示时间. <br>-T 显示每一调用所耗的时间. <br>-v 输出所有的系统调用.一些调用关于环境变量,状态,输入输出等调用由于使用频繁,默认不输出. <br>-V 输出strace的版本信息. <br>-x 以十六进制形式输出非标准字符串 <br>-xx 所有字符串以十六进制形式输出. <br>-a column <br>设置返回值的输出位置.默认 为40. <br>-e expr <br>指定一个表达式,用来控制如何跟踪.格式如下: <br>[qualifier=][!]value1[,value2]... <br>qualifier只能是 trace,abbrev,verbose,raw,signal,read,write其中之一.value是用来限定的符号或数字.默认的 qualifier是 trace.感叹号是否定符号.例如: <br>-eopen等价于 -e trace=open,表示只跟踪open调用.而-etrace!=open表示跟踪除了open以外的其他调用.有两个特殊的符号 all 和 none. <br>注意有些shell使用!来执行历史记录里的命令,所以要使用\\. <br>-e trace=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>只跟踪指定的系统 调用.例如:-e trace=open,close,rean,write表示只跟踪这四个系统调用.默认的为set=all. <br>-e trace=file <br>只跟踪有关文件操作的系统调用. <br>-e trace=process <br>只跟踪有关进程控制的系统调用. <br>-e trace=network <br>跟踪与网络有关的所有系统调用. <br>-e strace=signal <br>跟踪所有与系统信号有关的 系统调用 <br>-e trace=ipc <br>跟踪所有与进程通讯有关的系统调用 <br>-e abbrev=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>设定 strace输出的系统调用的结果集.-v 等与 abbrev=none.默认为abbrev=all. <br>-e raw=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>将指 定的系统调用的参数以十六进制显示. <br>-e signal=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>指定跟踪的系统信号.默认为all.如 signal=!SIGIO(或者signal=!io),表示不跟踪SIGIO信号. <br>-e read=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>输出从指定文件中读出 的数据.例如: <br>-e read=<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>,<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>5</span> <br>-e write=<span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>set</span> <br>输出写入到指定文件中的数据. <br>-o filename <br>将strace的输出写入文件filename <br>-p pid <br>跟踪指定的进程pid. <br>-s strsize <br>指定输出的字符串的最大长度.默认为32.文件名一直全部输出. <br>-u username <br>以username 的UID和GID执行被跟踪的命令</pre> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <h1 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:28px;font-style:normal;font-weight:bold;text-align:start;'><strong><span style='font-size:18pt;'>命令实例</span></strong></h1> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><br><strong>通用的完整用法：</strong></p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>strace -o output.txt -T -tt -e trace=all -p <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>28979</span></pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>上面的含义是 跟踪28979进程的所有系统调用（-e trace=all），并统计系统调用的花费时间，以及开始时间（并以可视化的时分秒格式显示），最后将记录结果存在output.txt文件里面。</p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <h1 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:28px;font-style:normal;font-weight:bold;text-align:start;'><strong><span style='font-size:18pt;'>strace案例</span></strong></h1> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><strong><span style='font-size:18pt;'>&nbsp;</span></strong></p> 
 <h2 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:21px;font-style:normal;font-weight:bold;text-align:start;'><span style='font-size:14pt;'><strong>&nbsp; 用strace调试程序</strong></span></h2> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>在理想世界里，每当一个程序不能正常执行一个功能时，它就会给出一个有用的错误提示，告诉你在足够的改正错误的线索。但遗憾的是，我们不是生活在理想世界 里，起码不总是生活在理想世界里。有时候一个程序出现了问题，你无法找到原因。<br>这就是调试程序出现的原因。strace是一个必不可少的 调试工具，strace用来监视系统调用。你不仅可以调试一个新开始的程序，也可以调试一个已经在运行的程序（把strace绑定到一个已有的PID上 面）。<br>首先让我们看一个真实的例子：启动KDE时出现问题<br>前一段时间，我在 启动KDE的时候出了问题，KDE的错误信息无法给我任何有帮助的线索。</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>_KDE_IceTransSocketCreateListener: failed to bind listener<br>_KDE_IceTransSocketUNIXCreateListener: ...SocketCreateListener() failed<br>_KDE_IceTransMakeAllCOTSServerListeners: failed to create listener <span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>for</span> local<br><br>Cannot establish any listening sockets DCOPServer self-test failed.</pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>对 我来说这个错误信息没有太多意义，只是一个对KDE来说至关重要的负责进程间通信的程序无法启动。我还可以知道这个错误和ICE协议（Inter Client Exchange）有关，除此之外，我不知道什么是KDE启动出错的原因。<strong><br></strong></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>我决定采用strace看一下在启动 dcopserver时到底程序做了什么：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>strace -f -F -o ~/dcop-strace.txt dcopserver</pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>这里 -f -F选项告诉strace同时跟踪fork和vfork出来的进程，-o选项把所有strace输出写到~/dcop-strace.txt里 面，dcopserver是要启动和调试的程序。</p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>再次出现错误之后，我检查了错误输出文件dcop-strace.txt，文件里有很多 系统调用的记录。在程序运行出错前的有关记录如下：<strong><br></strong></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> mkdir(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/tmp/.ICE-unix</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0777</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> EEXIST (File exists)<br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> lstat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/tmp/.ICE-unix</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, {st_mode=S_IFDIR|S_ISVTX|<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0755</span>, st_size=<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>4096</span>, ...}) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> unlink(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/tmp/.ICE-unix/dcop27207-1066844596</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> bind(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>, {sin_family=AF_UNIX, path=<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/tmp/.ICE-unix/dcop27207-1066844596</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>}, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>38</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> EACCES (Permission denied) <br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>_KDE_IceTrans</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>SocketCreateListener: failed to </span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>..., <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>46</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>46</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> close(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>3</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span> <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>_KDE_IceTrans</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>SocketUNIXCreateListener: ...Soc</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>..., <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>59</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>59</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> umask(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span> <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>_KDE_IceTrans</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>13</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>MakeAllCOTSServerListeners: fail</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>..., <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>64</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>64</span><br><span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>27207</span> write(<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>, <span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>Cannot establish any listening s</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>..., <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>39</span>) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>39</span></pre> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><span style='font-size:small;'><span style='font-size:small;'><br><span style='font-size:14px;'>其中第一行显示程序试图创建/tmp/.ICE-unix目录，权限为0777，这个操作因为目录已经存在而失败了。第二个系统调用（lstat64）检查 了目录状态，并显示这个目录的权限是0755，这里出现了第一个程序运行错误的线索：程序试图创建属性为0777的目录，但是已经存在了一个属性为 0755的目录。第三个系统调用（unlink）试图删除一个文件，但是这个文件并不存在。这并不奇怪，因为这个操作只是试图删掉可能存在的老文件。</span></span></span></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><span style='font-size:14px;'>但是，第四行确认了错误所在。他试图绑定到/tmp/.ICE-unix/dcop27207-1066844596，但是出现了拒绝访问错误。. ICE_unix目录的用户和组都是root，并且只有所有者具有写权限。一个非root用户无法在这个目录下面建立文件，如果把目录属性改成0777， 则前面的操作有可能可以执行，而这正是第一步错误出现时进行过的操作。</span></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><span style='font-size:14px;'>所以我运行了chmod 0777 /tmp/.ICE-unix之后KDE就可以正常启动了，问题解决了，用strace进行跟踪调试只需要花很短的几分钟时间跟踪程序运行，然后检查并分 析输出文件。</span></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'><span style='font-size:small;'><span style='font-size:small;'><span style='font-size:14px;'>说明：运行chmod 0777只是一个测试，一般不要把一个目录设置成所有用户可读写，同时不设置粘滞位(sticky bit)。给目录设置粘滞位可以阻止一个用户随意删除可写目录下面其他人的文件。一般你会发现/tmp目录因为这个原因设置了粘滞位。KDE可以正常启动 之后，运行chmod +t /tmp/.ICE-unix给.ICE_unix设置粘滞位。</span><br></span></span></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <h2 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:21px;font-style:normal;font-weight:bold;text-align:start;'><span style='font-size:14pt;'><strong>&nbsp; 解决库依赖问题</strong></span></h2> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>starce 的另一个用处是解决和动态库相关的问题。当对一个可执行文件运行ldd时，它会告诉你程序使用的动态库和找到动态库的位置。但是如果你正在使用一个比较老 的glibc版本（2.2或更早），你可能会有一个有bug的ldd程序，它可能会报告在一个目录下发现一个动态库，但是真正运行程序时动态连接程序 （/lib/ld-linux.so.2）却可能到另外一个目录去找动态连接库。这通常因为/etc/ld.so.conf和 /etc/ld.so.cache文件不一致，或者/etc/ld.so.cache被破坏。在glibc 2.3.2版本上这个错误不会出现，可能ld-linux的这个bug已经被解决了。<br><br>尽管这样，ldd并不能把所有程序依赖的动态库列出 来，系统调用dlopen可以在需要的时候自动调入需要的动态库，而这些库可能不会被ldd列出来。作为glibc的一部分的NSS（Name Server Switch）库就是一个典型的例子，NSS的一个作用就是告诉应用程序到哪里去寻找系统帐号数据库。应用程序不会直接连接到NSS库，glibc则会通 过dlopen自动调入NSS库。如果这样的库偶然丢失，你不会被告知存在库依赖问题，但这样的程序就无法通过用户名解析得到用户ID了。让我们看一个例子：<br>whoami程序会给出你自己的用户名，这个程序在一些需要知道运行程序的真正用户的脚本程序里面非常有用，whoami的一个示例 输出如下：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'># whoami<br>root</pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>假设因为某种原因在升 级glibc的过程中负责用户名和用户ID转换的库NSS丢失，我们可以通过把nss库改名来模拟这个环境：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'># mv /lib/libnss_files.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span> /lib/libnss_files.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span>.backup <br># whoami<br>whoami: cannot find username <span style='color:rgb(0, 0, 255);font-family:'Courier New' !important;font-size:12px !important;'>for</span> UID <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span></pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>这里你可以看到，运行whoami时出现了错误，ldd程序的输出不会提供有用的帮助：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'># ldd /usr/bin/whoami<br>libc.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>6</span> =&gt; /lib/libc.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>6</span> (<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0x4001f000</span>)<br>/lib/ld-linux.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span> =&gt; /lib/ld-linux.so.<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2</span> (<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0x40000000</span>)</pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>你只会看到whoami依赖Libc.so.6和ld-linux.so.2，它没有给出运行whoami所必须的其他库。这里时用strace跟踪 whoami时的输出：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>strace -o whoami-strace.txt whoami<br><br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/i686/mmx/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>stat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/i686/mmx</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xbffff190</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory) <br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/i686/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>stat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/i686</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xbffff190</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/mmx/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>stat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/mmx</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xbffff190</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory) <br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>stat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/lib</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, {st_mode=S_IFDIR|<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0755</span>, st_size=<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>2352</span>, ...}) = <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0</span><br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/usr/lib/i686/mmx/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)<br>stat64(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/usr/lib/i686/mmx</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, <span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>0xbffff190</span>) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory) <br>open(<span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>/usr/lib/i686/libnss_files.so.2</span><span style='color:rgb(128, 0, 0);font-family:'Courier New' !important;font-size:12px !important;'>'</span>, O_RDONLY) = -<span style='color:rgb(128, 0, 128);font-family:'Courier New' !important;font-size:12px !important;'>1</span> ENOENT (No such file or directory)</pre> 
  <div style='background-color:rgb(245, 245, 245);'> 
   <span style='font-family:'Courier New' !important;font-size:12px !important;'><img src='http://note.youdao.com/yws/res/2418/A19E3AE9845E4E19A35BFE7D2C7CCE5B' alt='复制代码' style='background-color:rgb(245, 245, 245) !important;' data-media-type='image'></span> 
  </div> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>你可以发现在不同目录下面查找libnss.so.2的尝试，但是都失败了。如果没有strace这样的工具，很难发现这个错误是由于缺少动态库造成的。现 在只需要找到libnss.so.2并把它放回到正确的位置就可以了。　</p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <h2 style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:21px;font-style:normal;font-weight:bold;text-align:start;'><span style='font-size:14pt;'><strong>&nbsp; 限制strace只跟踪特定的系统调用</strong></span></h2> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>如果你已经知道你要找什么，你可以让strace只跟踪一些类型的系统调用。例如，你需要看看在configure脚本里面执行的程序，你需要监视的系统调 用就是execve。让strace只记录execve的调用用这个命令：</p> 
 <div style='background-color:rgb(245, 245, 245);color:rgb(0, 0, 0);font-family:'Courier New' !important;font-size:12px !important;font-style:normal;font-weight:normal;text-align:start;'> 
  <pre style='font-family:'Courier New' !important;font-size:12px !important;'>strace -f -o configure-strace.txt -e execve ./configure</pre> 
 </div> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>&nbsp;</p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>参考资料:<a href='http://blog.sina.com.cn/s/blog_6e07f1eb0100t7rg.html' style='color:navy;'>http://blog.sina.com.cn/s/blog_6e07f1eb0100t7rg.html</a></p> 
 <p style='background-color:rgb(255, 255, 255);color:rgb(0, 0, 0);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;font-style:normal;font-weight:normal;text-align:start;'>　　　 　<a href='http://blog.csdn.net/zdl1016/article/details/6359598' style='color:navy;'>http://blog.csdn.net/zdl1016/article/details/6359598</a></p> 
 <br> 
</div>
 	<p class="tag"></p>
	<div style="display:none;">et_highlighter51</div>	<div class="nextlog">		&laquo; <a href="http://onelose.com/post-281.html">【问底】王帅：深入PHP内核（二）——SAPI探究</a>
				|
				 <a href="http://onelose.com/post-298.html">UPDATE `ts_user_job`SET`area_str`=CONCAT(SUBSTRING</a>&raquo;
	</div>
				    <div id="pagenavi">
	        </div>
		<div id="comment-place">
	<div class="comment-post" id="comment-post">
		<div class="cancel-reply" id="cancel-reply" style="display:none"><a href="javascript:void(0);" onclick="cancelReply()">取消回复</a></div>
		<p class="comment-header"><b>发表评论：</b><a name="respond"></a></p>
		<form method="post" name="commentform" action="http://onelose.com/index.php?action=addcom" id="commentform">
			<input type="hidden" name="gid" value="288" />
						<p>
				<input type="text" name="comname" maxlength="49" value="" size="22" tabindex="1">
				<label for="author"><small>昵称</small></label>
			</p>
			<p>
				<input type="text" name="commail"  maxlength="128"  value="" size="22" tabindex="2">
				<label for="email"><small>邮件地址 (选填)</small></label>
			</p>
			<p>
				<input type="text" name="comurl" maxlength="128"  value="" size="22" tabindex="3">
				<label for="url"><small>个人主页 (选填)</small></label>
			</p>
						<p><textarea name="comment" id="comment" rows="10" tabindex="4"></textarea></p>
			<p> <input type="submit" id="comment_submit" value="发表评论" tabindex="6" /></p>
			<input type="hidden" name="pid" id="comment-pid" value="0" size="22" tabindex="1"/>
		</form>
	</div>
	</div>
		<div style="clear:both;"></div>
</div><!--end #contentleft-->
<ul id="sidebar">
	<li>
	<h3><span>搜索</span></h3>
	<ul id="logsearch">
	<form name="keyform" method="get" action="http://onelose.com/index.php">
	<input name="keyword" class="search" type="text" />
	</form>
	</ul>
	</li>
	<li>
	<h3><span>最新微语</span></h3>
	<ul id="twitter">
			<li>诺基亚ceo可以对比尔盖茨说，主公，幸不辱命<p>2013-09-03 16:22</p></li>
			<li>换空间了<p>2013-09-02 23:28</p></li>
			<li>玩上古剑奇谭2了，画质非常好<p>2013-08-20 14:08</p></li>
			<li>最打算更新这个模板，估计会用上php<p>2013-08-16 23:10</p></li>
			<li>模板在emlog官网已经下载超过100次~\(≧▽≦)/~啦啦啦<p>2013-08-02 21:33</p></li>
	    	<p><a href="http://onelose.com/t/">更多&raquo;</a></p>
		</ul>
	</li>
	<li>
	<h3><span>随机文章</span></h3>
	<ul id="randlog">
		<li><a href="http://onelose.com/post-320.html">compileyourappwiththecommandbellowgcc-otest-L/usr/</a></li>
		<li><a href="http://onelose.com/post-552.html">array_intersect</a></li>
		<li><a href="http://onelose.com/post-109.html">大叔</a></li>
		<li><a href="http://onelose.com/post-345.html">Linux的计划任务</a></li>
		<li><a href="http://onelose.com/post-119.html">如何防图片盗链</a></li>
		</ul>
	</li>
	<li>
	<h3><span>最新文章</span></h3>
	<ul id="newlog">
		<li><a href="http://onelose.com/post-204.html">Redis数据库安全手册</a></li>
		<li><a href="http://onelose.com/post-200.html">MongoDB服务器端的JavaScript注入</a></li>
		<li><a href="http://onelose.com/post-202.html">http://www.freebuf.com/author/unshell</a></li>
		<li><a href="http://onelose.com/post-211.html">mysql性能优化方向</a></li>
		<li><a href="http://onelose.com/post-209.html">开源消息队列MemcacheQ在Linux中编译安装教程</a></li>
		</ul>
	</li>
	<li>
	<h3><span>最新评论</span></h3>
	<ul id="newcomment">
		<li id="comment">你大爷	<br /><a href="http://onelose.com/post-216.html#5096">我搞定了哈哈,不告诉你我是谁</a></li>
		<li id="comment">网络精灵	<br /><a href="http://onelose.com/post-113.html#4948">我想问改一下你的魔板的问题，能加下我QQ...</a></li>
		<li id="comment">9格购	<br /><a href="http://onelose.com/post-169.html#4698">很不错的模板</a></li>
		<li id="comment">陈正杰博客	<br /><a href="http://onelose.com/post-113.html#4649">好像很就没有更新内容了哟</a></li>
		<li id="comment">迷茫者	<br /><a href="http://onelose.com/post-113.html#4647">@彼岸时光网：O(∩_∩)O~&nbsp;&nbsp; 欢迎...</a></li>
		</ul>
	</li>
	<li>
	<h3><span>分类</span></h3>
	<ul id="blogsort">
		<li>
	<a href="http://onelose.com/sort/youdao">有道云笔记(305)</a>
	<a href="http://onelose.com/rss.php?sort=19"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/notes">学习笔记(8)</a>
	<a href="http://onelose.com/rss.php?sort=18"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/4">生活(1)</a>
	<a href="http://onelose.com/rss.php?sort=4"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/5">网站(7)</a>
	<a href="http://onelose.com/rss.php?sort=5"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/6">服务器(1)</a>
	<a href="http://onelose.com/rss.php?sort=6"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/7">动画片(1)</a>
	<a href="http://onelose.com/rss.php?sort=7"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/16">作业(1)</a>
	<a href="http://onelose.com/rss.php?sort=16"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			<li>
	<a href="http://onelose.com/sort/17">大学(1)</a>
	<a href="http://onelose.com/rss.php?sort=17"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.png" alt="订阅该分类"/></a>
			</ul>
	</li>
	<li>
	<h3><span>存档</span></h3>
	<ul id="record">
		<li><a href="http://onelose.com/record/201504">2015年4月(23)</a></li>
		<li><a href="http://onelose.com/record/201503">2015年3月(69)</a></li>
		<li><a href="http://onelose.com/record/201502">2015年2月(9)</a></li>
		<li><a href="http://onelose.com/record/201501">2015年1月(57)</a></li>
		<li><a href="http://onelose.com/record/201412">2014年12月(46)</a></li>
		<li><a href="http://onelose.com/record/201411">2014年11月(16)</a></li>
		<li><a href="http://onelose.com/record/201410">2014年10月(18)</a></li>
		<li><a href="http://onelose.com/record/201409">2014年9月(9)</a></li>
		<li><a href="http://onelose.com/record/201408">2014年8月(10)</a></li>
		<li><a href="http://onelose.com/record/201407">2014年7月(17)</a></li>
		<li><a href="http://onelose.com/record/201406">2014年6月(5)</a></li>
		<li><a href="http://onelose.com/record/201405">2014年5月(7)</a></li>
		<li><a href="http://onelose.com/record/201404">2014年4月(21)</a></li>
		<li><a href="http://onelose.com/record/201402">2014年2月(7)</a></li>
		<li><a href="http://onelose.com/record/201401">2014年1月(2)</a></li>
		<li><a href="http://onelose.com/record/201309">2013年9月(3)</a></li>
		<li><a href="http://onelose.com/record/201308">2013年8月(5)</a></li>
		<li><a href="http://onelose.com/record/201307">2013年7月(4)</a></li>
		<li><a href="http://onelose.com/record/201105">2011年5月(2)</a></li>
		<li><a href="http://onelose.com/record/201104">2011年4月(3)</a></li>
		<li><a href="http://onelose.com/record/201103">2011年3月(8)</a></li>
		<li><a href="http://onelose.com/record/201102">2011年2月(4)</a></li>
		<li><a href="http://onelose.com/record/201101">2011年1月(7)</a></li>
		<li><a href="http://onelose.com/record/201012">2010年12月(18)</a></li>
		<li><a href="http://onelose.com/record/201011">2010年11月(4)</a></li>
		<li><a href="http://onelose.com/record/201010">2010年10月(18)</a></li>
		<li><a href="http://onelose.com/record/201009">2010年9月(1)</a></li>
		<li><a href="http://onelose.com/record/201008">2010年8月(1)</a></li>
		<li><a href="http://onelose.com/record/201003">2010年3月(1)</a></li>
		</ul>
	</li>
	<li>
	<h3><span>链接</span></h3>
	<ul id="link">
		<li><a href="http://www.swoole.com/" title="Swoole：重新定义PHP" target="_blank">Swoole</a></li>
		<li><a href="http://rango.swoole.com/" title="" target="_blank">韩天峰(Rango)</a></li>
		<li><a href="http://www.laruence.com/" title="" target="_blank">风雪之隅</a></li>
		<li><a href="http://blog.csdn.net/ldy3243942" title="" target="_blank">ldy3243942的专栏</a></li>
		<li><a href="http://programmer.csdn.net/" title="" target="_blank">程序员</a></li>
		<li><a href="http://www.mysqlsupport.cn/" title="" target="_blank">mysqlsupport</a></li>
		<li><a href="http://www.ttlsa.com/" title="" target="_blank">运维生存时间</a></li>
		<li><a href="http://imysql.com/" title="" target="_blank">MySQL中文网</a></li>
		<li><a href="http://jinnianshilongnian.iteye.com/" title="" target="_blank">开涛的博客</a></li>
		<li><a href="http://www.imsiren.com/" title="Where Amaze happen，Where I Am !" target="_blank">斯人-吴帅</a></li>
		<li><a href="http://blog.41ms.com/" title="" target="_blank">松鼠先生</a></li>
		</ul>
	</li>
	<li>
	<h3><span>日历</span></h3>
	<div id="calendar">
	</div>
	<script>sendinfo('http://onelose.com:80/?action=cal','calendar');</script>
	</li>
	<li>
	<h3><span>蝴蝶</span></h3>
	<ul>
	<CENTER><EMBED style="RIGHT: 10px; POSITION: absolute; TOP: -40px" align=right src=http://onelose.com/butterfly.swf width=160 height=200 type=application/x-shockwave-flash wmode="transparent" quality="high" ;></CENTER>	</ul>
	</li>
	<li>
	<h3><span>水滴</span></h3>
	<ul>
	<CENTER><EMBED style="LEFT: 10px; POSITION: absolute; TOP: -30px" align=right src=http://onelose.com/1.swf width=700 height=160 type=application/x-shockwave-flash wmode="transparent" quality="high" ;></CENTER>	</ul>
	</li>
	<li>
	<h3><span>标签</span></h3>
	<ul id="blogtags">
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/php" title="1 篇文章">php</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/asp" title="1 篇文章">asp</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/c" title="1 篇文章">c</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/c%2B%2B" title="1 篇文章">c++</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/access" title="1 篇文章">access</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/pr" title="1 篇文章">pr</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/mssql2000" title="1 篇文章">mssql2000</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/msql2005" title="1 篇文章">msql2005</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/asp.net" title="1 篇文章">asp.net</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/javascript" title="1 篇文章">javascript</a></span>
			<span style="font-size:10pt; line-height:30px;">
		<a href="http://onelose.com/tag/emlog" title="1 篇文章">emlog</a></span>
			<span style="font-size:22pt; line-height:30px;">
		<a href="http://onelose.com/tag/mysql" title="2 篇文章">mysql</a></span>
		</ul>
	</li>
<div class="rss">
<a href="http://onelose.com/rss.php" title="RSS订阅"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/rss.gif" alt="订阅Rss"/></a>
</div>
</ul><!--end #siderbar-->
</div><!--end #content-->
<div style="clear:both;"></div>
<div id="footerbar">
	Design By blogbus | Theme By <a href="http://onelose.com" title="迷茫者博客">迷茫者</a> | Powered by <a href="http://www.emlog.net" title="emlog 5.1.2">emlog</a> |  
	<a href="http://www.miibeian.gov.cn" target="_blank">苏ICP备10020146号-1</a> | <!-- Piwik -->
<script type="text/javascript"> 
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.onelose.com//";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();

</script>
<noscript><p><img src="http://piwik.onelose.com/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Code -->
	<script type="text/javascript">XMLHttp.sendReq('GET','http://onelose.com/content/plugins/kl_auto_backup_and_mail/kl_auto_backup_and_mail_do.php','',function(obj){return;});</script>
<script type="text/javascript">$(function(){$.get("http://onelose.com/?plugin=autopub");})</script>
<script type="text/javascript" src="http://onelose.com/content/plugins/SHJS_for_Emlog/sh_main.min.js"></script><a href="http://onelose.com/sitemap.xml" rel="sitemap">sitemap</a></div><!--end #footerbar-->
</div><!--end #wrap-->
<script>prettyPrint();</script>

<div id="returnhome"><a href="#"><img src="http://onelose.com/content/templates/dpp_icecream_02/images/home.png" title="返回" alt="header" id="returnhome_img"></a></div>

</body>
</html>